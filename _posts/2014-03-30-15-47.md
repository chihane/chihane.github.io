---
layout: post
title: 更新了XmlParser类
date: 2014-03-30 15:47:00
categories: cnblogs
---

<p>还是发下GitHub地址吧，说不准有人感兴趣呢。</p>
<p>https://github.com/mlxy</p>
<p>代码：</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('1fa43143-6077-42fa-a82a-d14834df7272')"><img id="code_img_closed_1fa43143-6077-42fa-a82a-d14834df7272" class="code_img_closed" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" /><img id="code_img_opened_1fa43143-6077-42fa-a82a-d14834df7272" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('1fa43143-6077-42fa-a82a-d14834df7272',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt="" />
<div id="cnblogs_code_open_1fa43143-6077-42fa-a82a-d14834df7272" class="cnblogs_code_hide">
<pre><span style="color: #008080;">  1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> com.mlxy.xml;
</span><span style="color: #008080;">  2</span> 
<span style="color: #008080;">  3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.io.InputStream;
</span><span style="color: #008080;">  4</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.HashMap;
</span><span style="color: #008080;">  5</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.Map;
</span><span style="color: #008080;">  6</span> 
<span style="color: #008080;">  7</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.xmlpull.v1.XmlPullParser;
</span><span style="color: #008080;">  8</span> 
<span style="color: #008080;">  9</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> android.content.Context;
</span><span style="color: #008080;"> 10</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> android.util.Xml;
</span><span style="color: #008080;"> 11</span> 
<span style="color: #008080;"> 12</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> XmlParser {
</span><span style="color: #008080;"> 13</span>     <span style="color: #0000ff;">private</span><span style="color: #000000;"> Context parent;
</span><span style="color: #008080;"> 14</span>     <span style="color: #0000ff;">private</span><span style="color: #000000;"> XmlPullParser parser;
</span><span style="color: #008080;"> 15</span>     <span style="color: #0000ff;">private</span> Map&lt;String, String&gt;<span style="color: #000000;"> map;
</span><span style="color: #008080;"> 16</span>     <span style="color: #0000ff;">private</span><span style="color: #000000;"> String result;
</span><span style="color: #008080;"> 17</span>     
<span style="color: #008080;"> 18</span>     
<span style="color: #008080;"> 19</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> XmlParser(Context parent) {
</span><span style="color: #008080;"> 20</span>         <span style="color: #0000ff;">this</span>.parent =<span style="color: #000000;"> parent;
</span><span style="color: #008080;"> 21</span>         <span style="color: #0000ff;">this</span>.parser =<span style="color: #000000;"> Xml.newPullParser();
</span><span style="color: #008080;"> 22</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 23</span>     
<span style="color: #008080;"> 24</span>     <span style="color: #008000;">/**</span> 
<span style="color: #008080;"> 25</span> <span style="color: #008000;">     * 根据对应的标签检索标签内的内容。
</span><span style="color: #008080;"> 26</span> <span style="color: #008000;">     * 
</span><span style="color: #008080;"> 27</span> <span style="color: #008000;">     * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> tag 节点名称
</span><span style="color: #008080;"> 28</span> <span style="color: #008000;">     * </span><span style="color: #808080;">@return</span><span style="color: #008000;"> 返回标签内容，如果没有找到对应标签就返回空白字符。</span><span style="color: #008000;">*/</span>
<span style="color: #008080;"> 29</span>     <span style="color: #0000ff;">public</span> String getContentByTag(String tag) <span style="color: #0000ff;">throws</span><span style="color: #000000;"> Exception {
</span><span style="color: #008080;"> 30</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> 初始化输入流，指定编码。</span>
<span style="color: #008080;"> 31</span>         InputStream in =<span style="color: #000000;"> parent.openFileInput(XmlFile.getFile().getName());
</span><span style="color: #008080;"> 32</span>         parser.setInput(in, "UTF-8"<span style="color: #000000;">);
</span><span style="color: #008080;"> 33</span>         result = ""<span style="color: #000000;">;
</span><span style="color: #008080;"> 34</span>         
<span style="color: #008080;"> 35</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> 第一次获取事件。</span>
<span style="color: #008080;"> 36</span>         <span style="color: #0000ff;">int</span> eventType =<span style="color: #000000;"> parser.getEventType();
</span><span style="color: #008080;"> 37</span> 
<span style="color: #008080;"> 38</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> 当指针没有到文档结束位置的时候。</span>
<span style="color: #008080;"> 39</span>         <span style="color: #0000ff;">while</span> (eventType !=<span style="color: #000000;"> XmlPullParser.END_DOCUMENT) {
</span><span style="color: #008080;"> 40</span>             <span style="color: #008000;">//</span><span style="color: #008000;"> 如果发现了对应的标签就返回其中内容，然后跳出。</span>
<span style="color: #008080;"> 41</span>             <span style="color: #0000ff;">if</span> (eventType == XmlPullParser.START_TAG &amp;&amp;<span style="color: #000000;"> tag.equalsIgnoreCase(parser.getName())) {
</span><span style="color: #008080;"> 42</span>                 result =<span style="color: #000000;"> parser.nextText();
</span><span style="color: #008080;"> 43</span>                 <span style="color: #0000ff;">break</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 44</span> <span style="color: #000000;">            }
</span><span style="color: #008080;"> 45</span>             
<span style="color: #008080;"> 46</span>             <span style="color: #008000;">//</span><span style="color: #008000;"> 否则就继续循环。</span>
<span style="color: #008080;"> 47</span>             eventType =<span style="color: #000000;"> parser.next();
</span><span style="color: #008080;"> 48</span> <span style="color: #000000;">        }
</span><span style="color: #008080;"> 49</span> 
<span style="color: #008080;"> 50</span>         <span style="color: #008000;">//</span><span style="color: #008000;">释放资源。</span>
<span style="color: #008080;"> 51</span> <span style="color: #000000;">        in.close();
</span><span style="color: #008080;"> 52</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> result;
</span><span style="color: #008080;"> 53</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 54</span>     
<span style="color: #008080;"> 55</span>     <span style="color: #008000;">/**</span>
<span style="color: #008080;"> 56</span> <span style="color: #008000;">     * 根据给定的标签列表将对应的内容依次填入Map中并返回。
</span><span style="color: #008080;"> 57</span> <span style="color: #008000;">     * 
</span><span style="color: #008080;"> 58</span> <span style="color: #008000;">     * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> list 标签列表
</span><span style="color: #008080;"> 59</span> <span style="color: #008000;">     * </span><span style="color: #808080;">@return</span><span style="color: #008000;"> map 标签与内容一一对应的映射。
</span><span style="color: #008080;"> 60</span>      <span style="color: #008000;">*/</span>
<span style="color: #008080;"> 61</span>     <span style="color: #0000ff;">public</span> Map&lt;String, String&gt; getContentsByTags(String... tags) <span style="color: #0000ff;">throws</span><span style="color: #000000;"> Exception {
</span><span style="color: #008080;"> 62</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> 初始化输入流，指定编码。</span>
<span style="color: #008080;"> 63</span>         InputStream in =<span style="color: #000000;"> parent.openFileInput(XmlFile.getFile().getName());
</span><span style="color: #008080;"> 64</span>         parser.setInput(in, "UTF-8"<span style="color: #000000;">);
</span><span style="color: #008080;"> 65</span>         map = <span style="color: #0000ff;">new</span> HashMap&lt;String, String&gt;<span style="color: #000000;">();
</span><span style="color: #008080;"> 66</span>         
<span style="color: #008080;"> 67</span>         String tagName = <span style="color: #0000ff;">null</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 68</span>         <span style="color: #0000ff;">int</span> nulls = 0<span style="color: #000000;">;
</span><span style="color: #008080;"> 69</span>         
<span style="color: #008080;"> 70</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> 第一次获取事件。</span>
<span style="color: #008080;"> 71</span>         <span style="color: #0000ff;">int</span> eventType =<span style="color: #000000;"> parser.getEventType();
</span><span style="color: #008080;"> 72</span>         
<span style="color: #008080;"> 73</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> 当指针没有到文档结束位置的时候。</span>
<span style="color: #008080;"> 74</span>         <span style="color: #0000ff;">while</span> (eventType !=<span style="color: #000000;"> XmlPullParser.END_DOCUMENT) {
</span><span style="color: #008080;"> 75</span>             
<span style="color: #008080;"> 76</span>             <span style="color: #008000;">//</span><span style="color: #008000;"> 如果发现了标签开始处。</span>
<span style="color: #008080;"> 77</span>             <span style="color: #0000ff;">if</span> (eventType ==<span style="color: #000000;"> XmlPullParser.START_TAG) {
</span><span style="color: #008080;"> 78</span>                 <span style="color: #008000;">//</span><span style="color: #008000;"> 记下当前标签的名称。</span>
<span style="color: #008080;"> 79</span>                 tagName =<span style="color: #000000;"> parser.getName();
</span><span style="color: #008080;"> 80</span>                 
<span style="color: #008080;"> 81</span>                 <span style="color: #008000;">//</span><span style="color: #008000;"> 开始遍历数组。</span>
<span style="color: #008080;"> 82</span>                 <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">int</span> i = 0; i &lt; tags.length; i++<span style="color: #000000;">) {
</span><span style="color: #008080;"> 83</span>                     <span style="color: #008000;">//</span><span style="color: #008000;"> 如果当前位置是null，就进行下一项for循环。</span>
<span style="color: #008080;"> 84</span>                     <span style="color: #0000ff;">if</span> (tags[i] == <span style="color: #0000ff;">null</span><span style="color: #000000;">) {
</span><span style="color: #008080;"> 85</span>                         nulls++<span style="color: #000000;">;
</span><span style="color: #008080;"> 86</span>                         <span style="color: #0000ff;">continue</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 87</span> <span style="color: #000000;">                    }
</span><span style="color: #008080;"> 88</span>                     
<span style="color: #008080;"> 89</span>                     <span style="color: #008000;">//</span><span style="color: #008000;"> 找到对应的标签就取出内容，添加进映射里。然后把数组的当前位置改为null并继续寻找下一个标签。</span>
<span style="color: #008080;"> 90</span>                     <span style="color: #0000ff;">if</span><span style="color: #000000;"> (tags[i].equalsIgnoreCase(tagName)) {
</span><span style="color: #008080;"> 91</span> <span style="color: #000000;">                        map.put(tags[i], parser.nextText());
</span><span style="color: #008080;"> 92</span>                         tags[i] = <span style="color: #0000ff;">null</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 93</span>                         <span style="color: #0000ff;">break</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 94</span> <span style="color: #000000;">                    }
</span><span style="color: #008080;"> 95</span>                     
<span style="color: #008080;"> 96</span> <span style="color: #000000;">                }
</span><span style="color: #008080;"> 97</span>                 
<span style="color: #008080;"> 98</span> <span style="color: #000000;">            }
</span><span style="color: #008080;"> 99</span>             
<span style="color: #008080;">100</span>             <span style="color: #008000;">//</span><span style="color: #008000;"> 如果数组已经处理完毕就停止处理文档。</span>
<span style="color: #008080;">101</span>             <span style="color: #0000ff;">if</span> (nulls ==<span style="color: #000000;"> tags.length) {
</span><span style="color: #008080;">102</span>                 <span style="color: #0000ff;">break</span><span style="color: #000000;">;
</span><span style="color: #008080;">103</span>             } <span style="color: #0000ff;">else</span><span style="color: #000000;"> {
</span><span style="color: #008080;">104</span>                 nulls = 0<span style="color: #000000;">;
</span><span style="color: #008080;">105</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">106</span>             
<span style="color: #008080;">107</span>             <span style="color: #008000;">//</span><span style="color: #008000;"> 否则就继续循环。</span>
<span style="color: #008080;">108</span>             eventType =<span style="color: #000000;"> parser.next();
</span><span style="color: #008080;">109</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">110</span> 
<span style="color: #008080;">111</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> 处理完毕，释放资源。</span>
<span style="color: #008080;">112</span> <span style="color: #000000;">        in.close();
</span><span style="color: #008080;">113</span>         
<span style="color: #008080;">114</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> map;
</span><span style="color: #008080;">115</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">116</span> }</pre>
</div>
<span class="cnblogs_code_collapse">可变参数</span></div>
<p>&nbsp;</p>

<p align=right><span style="font-size: 12px">——本文由博客园搬家工具<a href="https://github.com/mlxy/SRBCnblogs">SRBCnblogs</a>转换而成</span></p>