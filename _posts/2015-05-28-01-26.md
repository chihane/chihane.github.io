---
layout: post
title: 回忆一个加塞方法
date: 2015-05-28 01:26:00
categories: cnblogs
---

<p>Thread.join()用来让当前线程插队。</p>
<div class="cnblogs_code">
<pre><span style="color: #008080;"> 1</span>     <span style="color: #0000ff;">static</span><span style="color: #000000;"> Thread main;
</span><span style="color: #008080;"> 2</span>     <span style="color: #0000ff;">static</span><span style="color: #000000;"> Thread threadA;
</span><span style="color: #008080;"> 3</span>     <span style="color: #0000ff;">static</span><span style="color: #000000;"> Thread threadB;
</span><span style="color: #008080;"> 4</span>     
<span style="color: #008080;"> 5</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span> main(String[] args) <span style="color: #0000ff;">throws</span><span style="color: #000000;"> InterruptedException {
</span><span style="color: #008080;"> 6</span>         main =<span style="color: #000000;"> Thread.currentThread();
</span><span style="color: #008080;"> 7</span>         
<span style="color: #008080;"> 8</span>         <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">int</span> i = 0; i &lt; 10; i++<span style="color: #000000;">) {
</span><span style="color: #008080;"> 9</span>             System.out.println("Main " +<span style="color: #000000;"> i);
</span><span style="color: #008080;">10</span>             
<span style="color: #008080;">11</span>             <span style="color: #0000ff;">if</span> (i == 5<span style="color: #000000;">) {
</span><span style="color: #008080;">12</span>                 threadA = <span style="color: #0000ff;">new</span> Thread(<span style="color: #0000ff;">new</span><span style="color: #000000;"> RunnerA());
</span><span style="color: #008080;">13</span> <span style="color: #000000;">                threadA.start();
</span><span style="color: #008080;">14</span> <span style="color: #000000;">                threadA.join();
</span><span style="color: #008080;">15</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">16</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">17</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">18</span>     
<span style="color: #008080;">19</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">class</span> RunnerA <span style="color: #0000ff;">implements</span><span style="color: #000000;"> Runnable {
</span><span style="color: #008080;">20</span>         <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> run() {
</span><span style="color: #008080;">21</span>             <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">int</span> j = 0; j &lt; 10; j++<span style="color: #000000;">) {
</span><span style="color: #008080;">22</span>                 System.out.println("A " +<span style="color: #000000;"> j);
</span><span style="color: #008080;">23</span>                 
<span style="color: #008080;">24</span>                 <span style="color: #0000ff;">if</span> (j == 5<span style="color: #000000;">) {
</span><span style="color: #008080;">25</span>                     threadB = <span style="color: #0000ff;">new</span> Thread(<span style="color: #0000ff;">new</span><span style="color: #000000;"> RunnerB());
</span><span style="color: #008080;">26</span> <span style="color: #000000;">                    threadB.start();
</span><span style="color: #008080;">27</span>                     <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
</span><span style="color: #008080;">28</span> <span style="color: #000000;">                        threadB.join();
</span><span style="color: #008080;">29</span>                     } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (InterruptedException e) {}
</span><span style="color: #008080;">30</span> <span style="color: #000000;">                }
</span><span style="color: #008080;">31</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">32</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">33</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">34</span>     
<span style="color: #008080;">35</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">class</span> RunnerB <span style="color: #0000ff;">implements</span><span style="color: #000000;"> Runnable {
</span><span style="color: #008080;">36</span>         <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> run() {
</span><span style="color: #008080;">37</span>             <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">int</span> j = 0; j &lt; 10; j++<span style="color: #000000;">) {
</span><span style="color: #008080;">38</span>                 System.out.println("BB " +<span style="color: #000000;"> j);
</span><span style="color: #008080;">39</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">40</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">41</span>     }</pre>
</div>
<p>上面的代码中，主线程打印数字到5的时候被A线程插队，A线程打印到5的时候又被B线程插队，等到BA依次打印完之后主线程才继续打印6到9。</p>
<p>&nbsp;</p>
<p>如果把B线程的加塞语句移到A线程for循环结束之后或主线程中A线程的加塞语句之后执行，则主线程打印到5之后AB会依次打印0到9，然后再轮到主线程。</p>
<p>&nbsp;</p>
<p>一个思考题。</p>
<p>如果把A线程中的加塞语句改成下面这样：</p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff;">if</span> (j == 5<span style="color: #000000;">) {</span><span style="color: #0000ff;">try</span><span style="color: #000000;"> {
        main.join();
    } </span><span style="color: #0000ff;">catch</span><span style="color: #000000;"> (InterruptedException e) {}
}</span></pre>
</div>
<p>那么主线程和A线程都只打印到5程序就结束了。</p>
<p>&nbsp;</p>
<p>为什么？</p>

<div align=right><a href="https://github.com/mlxy/SRBCnblogs"><font size=1>——本文由博客园搬家工具SRBCnblogs转换而成</font></a></div>