---
layout: post
title: 五月蝇
date: 2015-01-15 06:04:00
categories: cnblogs
---

<p>打开叫plug-ins的那个View，找到org.eclipse.jface.text，右键import as -&gt; Source Project。</p>
<p>org.eclipse.jface.text.contentassist包下的CompletionProposalPopup类，在verifyKey方法下有这么一段代码，</p>
<div class="cnblogs_code">
<pre><span style="color: #008080;"> 1</span> <span style="color: #008000;">//</span><span style="color: #008000;"> key != 0</span>
<span style="color: #008080;"> 2</span> <span style="color: #0000ff;">switch</span><span style="color: #000000;"> (key) {
</span><span style="color: #008080;"> 3</span>     <span style="color: #0000ff;">case</span> 0x1B: <span style="color: #008000;">//</span><span style="color: #008000;"> Esc</span>
<span style="color: #008080;"> 4</span>         e.doit= <span style="color: #0000ff;">false</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 5</span> <span style="color: #000000;">        hide();
</span><span style="color: #008080;"> 6</span>         <span style="color: #0000ff;">break</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 7</span> 
<span style="color: #008080;"> 8</span>     <span style="color: #0000ff;">case</span> '\n': <span style="color: #008000;">//</span><span style="color: #008000;"> Ctrl-Enter on w2k</span>
<span style="color: #008080;"> 9</span>     <span style="color: #0000ff;">case</span> '\r': <span style="color: #008000;">//</span><span style="color: #008000;"> Enter</span>
<span style="color: #008080;">10</span>         e.doit= <span style="color: #0000ff;">false</span><span style="color: #000000;">;
</span><span style="color: #008080;">11</span> <span style="color: #000000;">        insertSelectedProposalWithMask(e.stateMask);
</span><span style="color: #008080;">12</span>         <span style="color: #0000ff;">break</span><span style="color: #000000;">;
</span><span style="color: #008080;">13</span> 
<span style="color: #008080;">14</span>     <span style="color: #0000ff;">case</span> '\t'<span style="color: #000000;">:
</span><span style="color: #008080;">15</span>         e.doit= <span style="color: #0000ff;">false</span><span style="color: #000000;">;
</span><span style="color: #008080;">16</span> <span style="color: #000000;">        fProposalShell.setFocus();
</span><span style="color: #008080;">17</span>         <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">false</span><span style="color: #000000;">;
</span><span style="color: #008080;">18</span> 
<span style="color: #008080;">19</span>     <span style="color: #0000ff;">default</span><span style="color: #000000;">:
</span><span style="color: #008080;">20</span>         ICompletionProposal p=<span style="color: #000000;"> getSelectedProposal();
</span><span style="color: #008080;">21</span>         <span style="color: #0000ff;">if</span> (p <span style="color: #0000ff;">instanceof</span><span style="color: #000000;"> ICompletionProposalExtension) {
</span><span style="color: #008080;">22</span>             ICompletionProposalExtension t=<span style="color: #000000;"> (ICompletionProposalExtension) p;
</span><span style="color: #008080;">23</span>             <span style="color: #0000ff;">char</span>[] triggers=<span style="color: #000000;"> t.getTriggerCharacters();
</span><span style="color: #008080;">24</span>             <span style="color: #0000ff;">if</span><span style="color: #000000;"> (contains(triggers, key)) {
</span><span style="color: #008080;">25</span>                 e.doit= <span style="color: #0000ff;">false</span><span style="color: #000000;">;
</span><span style="color: #008080;">26</span> <span style="color: #000000;">                hide();
</span><span style="color: #008080;">27</span> <span style="color: #000000;">                insertProposal(p, key, e.stateMask, fContentAssistSubjectControlAdapter.getSelectedRange().x);
</span><span style="color: #008080;">28</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">29</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">30</span> }</pre>
</div>
<p>用以处理提示窗口弹出状态下用户的按键动作。</p>
<p>首先毫不留情地把第四个case也就是Tab键的处理注释掉。我按Tab键的时候就是想在编辑器里加上一个制表符，我已经不需要提示了，更不需要把焦点移到提示框里，反正就算焦点不在里面，按上下键也是可以选择的。</p>
<p>然后处理上边那段代码的第二十四行里的判断，避免按个空格按个等号按个分号提示就直接上屏了。</p>
<p>比如敲private String test时，Eclipse会自作主张的给你一个驼峰建议，问你是不是要输testString，这时候如果手快输入一个空格，变量名当场就变testString了，而我只是想输private String test = "blahblahblah";而已。</p>
<p>总之把不想按了之后自动上屏的键<a href="http://baike.baidu.com/link?url=i7T480G4jaQh1VzjILKkxRicAz0lV9aByM-UzBbYF-0XCLrhq8LIj7XDifUj3DcXYZthV9kdHZ8S4Qy6uVx5hq" target="_blank">的ASCII值</a>加到判断里，以后就不会出现这种问题了。</p>
<p>举个栗子：</p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff;">if</span> (key != '=' &amp;&amp; key != 0x20 &amp;&amp; key != 0x3B &amp;&amp; key != 0x3A &amp;&amp; key != 0x2E &amp;&amp; contains(triggers, key)) {</pre>
</div>
<p>&nbsp;</p>
<p>最后在修改过的项目上右键导出为Deployable plug-ins and fragments，Destination选Archive file随便给个名字，把导出的压缩包里面的jar文件扔到Eclipse的plugins文件夹里覆盖就搞定了。</p>

<p align=right><span style="font-size: 12px">——本文由博客园搬家工具<a href="https://github.com/mlxy/SRBCnblogs">SRBCnblogs</a>转换而成</span></p>