---
layout: post
title: 三年六班的李子明同学，你妈拿了两本计算机基础在二号树上等你
date: 2015-05-20 08:31:00
categories: cnblogs
---

<p>用</p>
<div class="cnblogs_code">
<pre>MessageDigest.getInstance("md5")</pre>
</div>
<p>初始化，用</p>
<div class="cnblogs_code">
<pre>MessageDigest.digest(<span style="color: #0000ff;">byte</span>[] input)</pre>
</div>
<p>方法执行MD5加密，返回的结果也是个byte数组。</p>
<p>&nbsp;</p>
<p>然后把数组中每一个字节转换成两位的十六进制字符串，如果结果只有一位的话在前面添零补位。</p>
<p>结果就是一个30位长度的MD5字符串了。</p>
<div class="cnblogs_code">
<pre><span style="color: #008080;"> 1</span> <span style="color: #008000;">/**</span><span style="color: #008000;"> 对数据作MD5加密。 </span><span style="color: #008000;">*/</span>
<span style="color: #008080;"> 2</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span><span style="color: #000000;"> String hashUp(String src) {
</span><span style="color: #008080;"> 3</span>     String hash = <span style="color: #0000ff;">null</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 4</span> 
<span style="color: #008080;"> 5</span>     <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
</span><span style="color: #008080;"> 6</span>         <span style="color: #0000ff;">byte</span>[] md5 = MessageDigest.getInstance("md5"<span style="color: #000000;">).digest(src.getBytes());
</span><span style="color: #008080;"> 7</span> 
<span style="color: #008080;"> 8</span>         StringBuilder builder = <span style="color: #0000ff;">new</span><span style="color: #000000;"> StringBuilder();
</span><span style="color: #008080;"> 9</span>         <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">byte</span><span style="color: #000000;"> b : md5) {
</span><span style="color: #008080;">10</span>             String hex = Integer.toHexString(0xff &amp;<span style="color: #000000;"> b);
</span><span style="color: #008080;">11</span>             <span style="color: #0000ff;">if</span> (hex.length() == 1<span style="color: #000000;">) {
</span><span style="color: #008080;">12</span>                 builder.append('0'<span style="color: #000000;">);
</span><span style="color: #008080;">13</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">14</span> 
<span style="color: #008080;">15</span> <span style="color: #000000;">            builder.append(hex);
</span><span style="color: #008080;">16</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">17</span>         hash =<span style="color: #000000;"> builder.toString();
</span><span style="color: #008080;">18</span>     } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (NoSuchAlgorithmException e) {
</span><span style="color: #008080;">19</span> <span style="color: #000000;">        e.printStackTrace();
</span><span style="color: #008080;">20</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">21</span> 
<span style="color: #008080;">22</span>     <span style="color: #0000ff;">return</span><span style="color: #000000;"> hash;
</span><span style="color: #008080;">23</span> }</pre>
</div>
<p>&nbsp;</p>
<p>但是！重点是！</p>
<p>为什么要用0xff来与一下b呢？</p>
<p>因为不这样处理的话b是正数还不要紧，是负数的话结果就不对了。</p>
<p>&nbsp;</p>
<p>首先假设MD5结果中某一位是26，byte类型长8位，二进制形式是：</p>
<p>0001 1010</p>
<p>因为toHexString方法需要的参数是int类型，所以要把b强转成int，变成了32位，于是前24位填零补位，二进制形式是：</p>
<p>0000 0000 0000 0000 0000 0000 0001 1010</p>
<p>把参数转成十六进制，结果是：</p>
<p>0000001A</p>
<p>前面的0全部省略，结果是1A，没有问题。</p>
<p>&nbsp;</p>
<p>但是这某一位变成了-26会怎么样呢？</p>
<p>负数在计算机中用正数的补码形式存储，于是把26的二进制值每一位取反再加一，结果是：</p>
<p>1110 0110</p>
<p>于是再把它强转为32位，也就是26的补码。这一转不要紧，结果成了：</p>
<p>1111 1111 1111 1111 1111 1111 1110 0110</p>
<p>蔚为大观。</p>
<p>这个时候再四位一转，把它转成十六进制，结果就是：</p>
<p>FFFFFFE6</p>
<p>符号变了一下，结果变得妈都不认识了。</p>
<p>&nbsp;</p>
<p>虽然结果好像没什么问题，但是前面的一堆F可不打算直接拿来用。</p>
<p>于是干脆一了百了，把int值的前24位都扔了不要，用0xff，也就是：</p>
<p>0000 0000 0000 0000 0000 0000 1111 1111</p>
<p>与上它：</p>
<p>1111 1111 1111 1111 1111 1111 1110 0110</p>
<p>前24位当场就没了，真是太惨了：</p>
<p>0000 0000 0000 0000 0000 0000 1110 0110</p>
<p>这时候再转成十六进制，结果是E6，虽然跟开始的值不一样，</p>
<p>&hellip;&hellip;</p>
<p>&hellip;&hellip;&hellip;&hellip;</p>
<p>但是反正也没人在乎&hellip;&hellip;</p>

<div align=right><a href="https://github.com/mlxy/SRBCnblogs"><font size=1>——本文由博客园搬家工具SRBCnblogs转换而成</font></a></div>