---
layout: post
title: 零一生随机，随机生万物
date: 2015-03-09 02:08:00
categories: cnblogs
---

<p>https://github.com/mlxy/RandomRingtones</p>
<p>在每次来电的时候随机修改铃声。</p>
<p>结果就是每次来电的铃声都不一样。</p>
<p>给S1er写的。</p>
<p>&nbsp;</p>
<p>几个知识点：</p>
<p>&nbsp;</p>
<p>1. File类里有个listFiles方法，这个玩意在学Python的时候明明一开始就用到了不知道为什么我现在才第一次用。方法接收一个FilenameFilter参数，直接用匿名类填进去，然后重写accept方法这个知识点简直弱智到不能自理我为什么要单独把它写出来。嗯，就是自己写个过滤器我还是不接着说了吧。</p>
<p>&nbsp;</p>
<p>2. 修改系统铃声的问题，直接看代码。</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('980f2250-f460-4106-96a2-b9c2909f3397')"><img id="code_img_closed_980f2250-f460-4106-96a2-b9c2909f3397" class="code_img_closed" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" /><img id="code_img_opened_980f2250-f460-4106-96a2-b9c2909f3397" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('980f2250-f460-4106-96a2-b9c2909f3397',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt="" />
<div id="cnblogs_code_open_980f2250-f460-4106-96a2-b9c2909f3397" class="cnblogs_code_hide">
<pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> setRingtone(Context context, File ringtoneFile) {
</span><span style="color: #008080;"> 2</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> 铃声的属性。</span>
<span style="color: #008080;"> 3</span>     ContentValues values = <span style="color: #0000ff;">new</span><span style="color: #000000;"> ContentValues();
</span><span style="color: #008080;"> 4</span> <span style="color: #000000;">    values.put(MediaStore.MediaColumns.DATA, ringtoneFile.getAbsolutePath());
</span><span style="color: #008080;"> 5</span> <span style="color: #000000;">    values.put(MediaStore.MediaColumns.TITLE, ringtoneFile.getName());
</span><span style="color: #008080;"> 6</span>     values.put(MediaStore.MediaColumns.MIME_TYPE, "audio/mp3"<span style="color: #000000;">);
</span><span style="color: #008080;"> 7</span>     values.put(MediaStore.Audio.Media.ARTIST, " "<span style="color: #000000;">);
</span><span style="color: #008080;"> 8</span> <span style="color: #000000;">    values.put(MediaStore.MediaColumns.SIZE, ringtoneFile.getUsableSpace());
</span><span style="color: #008080;"> 9</span>     values.put(MediaStore.Audio.Media.IS_RINGTONE, <span style="color: #0000ff;">true</span><span style="color: #000000;">);
</span><span style="color: #008080;">10</span>     values.put(MediaStore.Audio.Media.IS_NOTIFICATION, <span style="color: #0000ff;">false</span><span style="color: #000000;">);
</span><span style="color: #008080;">11</span>     values.put(MediaStore.Audio.Media.IS_ALARM, <span style="color: #0000ff;">false</span><span style="color: #000000;">);
</span><span style="color: #008080;">12</span>     values.put(MediaStore.Audio.Media.IS_MUSIC, <span style="color: #0000ff;">false</span><span style="color: #000000;">);
</span><span style="color: #008080;">13</span> 
<span style="color: #008080;">14</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> 从媒体库中删除并重新插入。</span>
<span style="color: #008080;">15</span>     Uri uri =<span style="color: #000000;"> MediaStore.Audio.Media.getContentUriForPath(ringtoneFile.getAbsolutePath());
</span><span style="color: #008080;">16</span>     context.getContentResolver().delete(uri, MediaStore.MediaColumns.DATA + "=\"" + ringtoneFile.getAbsolutePath() + "\"", <span style="color: #0000ff;">null</span><span style="color: #000000;">);
</span><span style="color: #008080;">17</span>     Uri newUri =<span style="color: #000000;"> context.getContentResolver().insert(uri, values);
</span><span style="color: #008080;">18</span>     
<span style="color: #008080;">19</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> 设置新铃声。</span>
<span style="color: #008080;">20</span> <span style="color: #000000;">    RingtoneManager.setActualDefaultRingtoneUri(context, RingtoneManager.TYPE_RINGTONE, newUri);
</span><span style="color: #008080;">21</span> }</pre>
</div>
<span class="cnblogs_code_collapse">青山黛玛</span></div>
<p>看着现成的代码对着改挺简单的，要自己重写就难了。所以记一下还是挺有必要的。</p>
<p>MimeType后面改成星号应该能支持更多的音频类型，但是要自己一个一个测，干脆就只让用MP3了。</p>
<p>艺术家随便填。</p>
<p>第二步中首先把铃声从媒体库中删除的一步挺重要的，网上很多代码没有这一行，我之前测试的时候没这行就不能用。</p>
<p>剩下的就都是API调用。</p>
<p>我觉得还是不要硬背，用得到的时候再现查吧。</p>
<p>&nbsp;</p>
<p>3. 从Android3.1之后，用户手动强制停止的应用状态和刚安装还没打开时一样，所以广播接收器也失效了。我暂时没想出解决办法，不知道那些大流氓是怎么驻留后台的。</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>之后再手绘一个图标上去。</p>

<div align=right><a href="https://github.com/mlxy/SRBCnblogs"><font size=1>——本文由博客园搬家工具SRBCnblogs转换而成</font></a></div>