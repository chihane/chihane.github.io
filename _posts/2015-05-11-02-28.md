---
layout: post
title: 这位少侠我看你百会穴发绿啊
date: 2015-05-11 02:28:00
categories: cnblogs
---

<p>https://github.com/mlxy/FacePlusPlusDemo</p>
<p>&nbsp;</p>
<p>一个超良心的人脸识别接口，完全免费，开发者版给三个并发，个人用足够。</p>
<p>开发者中心里建个应用就可以用了。</p>
<p>官网在这：http://www.faceplusplus.com.cn/</p>
<p>&nbsp;</p>
<p>API简洁易懂，有两个概念。</p>
<p>一个是人(Person)，一个是脸(Face)。</p>
<p>还有人群Group和脸集合FaceSet。</p>
<p>Demo用到了人脸识别接口Detect，用Post方式提交图片数据或者Get提交图片URL都行，结果包括年龄、性别、是否戴眼镜和眼镜类型、人种和笑容值，还包括误差和可信度。</p>
<p>还用到了相似度比对接口Verify，返回两张脸的相似度。不过提交的是脸的ID，所以需要先行识别两张脸获取返回的FaceID。</p>
<p>只识别不保存到人(Person)的脸(Face)只给保存72小时，如果不需要保存只做一次性识别的话无所谓。</p>
<p>&nbsp;</p>
<p>Demo的界面就很简单了，用了一个图片选择器来选照片，然后调用系统相机拍照，只上传一个或两个都上传，最后简单显示结果。</p>
<p>&nbsp;</p>
<p><span style="text-decoration: underline;"><strong>选择照片：</strong></span></p>
<p>用隐式意图开一个文件选择器，Action用自带的图片类型。</p>
<div class="cnblogs_code">
<pre>Intent intent = <span style="color: #0000ff;">new</span><span style="color: #000000;"> Intent(</span>"android.intent.action.PICK", MediaStore.Images.Media.EXTERNAL_CONTENT_URI<span>);<br /></span><span>startActivityForResult(intent, </span>2);</pre>
</div>
<p>返回的结果是一个URI，用网上找到的工具类转成具体路径。</p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> String getRealFilePath(<span style="color: #0000ff;">final</span> Context context, <span style="color: #0000ff;">final</span><span style="color: #000000;"> Uri uri) {
    </span><span style="color: #0000ff;">if</span> (<span style="color: #0000ff;">null</span> ==<span style="color: #000000;"> uri)
        </span><span style="color: #0000ff;">return</span> <span style="color: #0000ff;">null</span><span style="color: #000000;">;
    </span><span style="color: #0000ff;">final</span> String scheme =<span style="color: #000000;"> uri.getScheme();
    String data </span>= <span style="color: #0000ff;">null</span><span style="color: #000000;">;
    </span><span style="color: #0000ff;">if</span> (scheme == <span style="color: #0000ff;">null</span><span style="color: #000000;">)
        data </span>=<span style="color: #000000;"> uri.getPath();
    </span><span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span><span style="color: #000000;"> (ContentResolver.SCHEME_FILE.equals(scheme)) {
        data </span>=<span style="color: #000000;"> uri.getPath();
    } </span><span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span><span style="color: #000000;"> (ContentResolver.SCHEME_CONTENT.equals(scheme)) {
        Cursor cursor </span>= context.getContentResolver().query(uri, <span style="color: #0000ff;">new</span> String[] { ImageColumns.DATA }, <span style="color: #0000ff;">null</span>, <span style="color: #0000ff;">null</span>, <span style="color: #0000ff;">null</span><span style="color: #000000;">);
        </span><span style="color: #0000ff;">if</span> (<span style="color: #0000ff;">null</span> !=<span style="color: #000000;"> cursor) {
            </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (cursor.moveToFirst()) {
                </span><span style="color: #0000ff;">int</span> index =<span style="color: #000000;"> cursor.getColumnIndex(ImageColumns.DATA);
                </span><span style="color: #0000ff;">if</span> (index &gt; -1<span style="color: #000000;">) {
                    data </span>=<span style="color: #000000;"> cursor.getString(index);
                }
            }
            cursor.close();
        }
    }
    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> data;
}</span></pre>
</div>
<p>把图片解码出来。</p>
<div class="cnblogs_code">
<pre>BitmapFactory.decodeFile(path);</pre>
</div>
<p>压缩成字节数组上传就行了。</p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">byte</span><span style="color: #000000;">[] bitmap2Bytes(Bitmap bm) {
    ByteArrayOutputStream baos </span>= <span style="color: #0000ff;">new</span><span style="color: #000000;"> ByteArrayOutputStream();
    bm.compress(Bitmap.CompressFormat.PNG, </span>100<span style="color: #000000;">, baos);
    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> baos.toByteArray();
}</span></pre>
</div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>拍照的Action用这个</p>
<div class="cnblogs_code">
<pre>MediaStore.ACTION_IMAGE_CAPTURE</pre>
</div>
<p>返回的结果键名是data，内容就是Bitmap，强转一下就行了。</p>

<p align=right><span style="font-size: 12px">——本文由博客园搬家工具<a href="https://github.com/mlxy/SRBCnblogs">SRBCnblogs</a>转换而成</span></p>