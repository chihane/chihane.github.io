---
layout: post
title: 设计模式，3/23，模板方法模式
date: 2014-03-19 13:19:00
categories: cnblogs
---

<p>定义一个抽象类。</p>
<p>核心是一个不可变的模板方法，由它来定义算法结构。</p>
<p>子类则可以改写算法中的一些具体步骤。</p>
<p>像这样：</p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">final</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> templateMethod() {
    step1();
    step2();
    step3();
}</span></pre>
</div>
<div class="cnblogs_code">
<pre><span style="color: #0000ff;">protected</span> <span style="color: #0000ff;">abstract</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> step3();
</span><span style="color: #0000ff;">protected</span> <span style="color: #0000ff;">abstract</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> step2();
</span><span style="color: #0000ff;">protected</span> <span style="color: #0000ff;">abstract</span> <span style="color: #0000ff;">void</span> step1();</pre>
</div>
<p>&nbsp;</p>
<p>为了防止算法被子类随意改写，加上final关键字。</p>
<p>但是模板方法也不是绝对定死的，也可以加入一个钩子(Hook)方法来改变模板方法的运行过程。</p>
<p>像这样：</p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff;">protected</span> <span style="color: #0000ff;">boolean</span><span style="color: #000000;"> isBlahBlah() {
    </span><span style="color: #0000ff;">return</span> <span style="color: #0000ff;">true</span><span style="color: #000000;">;
}</span></pre>
</div>
<p>于是模板方法就可以写成这样：</p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">final</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> templateMethod() {
    step1();
    step2();
    
    </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (isBlahBlah()) {
        step3();
    }
}</span></pre>
</div>
<p>&nbsp;</p>
<p>子类可以自行改写钩子方法来决定要不要执行第三步的方法。</p>
<p>&nbsp;</p>
<p>对的，模板方法的自由度非常低，但是有的时候秩序和自由一样重要。</p>
<p>&nbsp;</p>
<p>于是先总结一下，写出一个抽象类来。</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('52a29e00-a872-49c3-a0dd-b8fb03353f83')"><img id="code_img_closed_52a29e00-a872-49c3-a0dd-b8fb03353f83" class="code_img_closed" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" /><img id="code_img_opened_52a29e00-a872-49c3-a0dd-b8fb03353f83" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('52a29e00-a872-49c3-a0dd-b8fb03353f83',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt="" />
<div id="cnblogs_code_open_52a29e00-a872-49c3-a0dd-b8fb03353f83" class="cnblogs_code_hide">
<pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">abstract</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> AbstractClass {
</span><span style="color: #008080;"> 2</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">final</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> templateMethod() {
</span><span style="color: #008080;"> 3</span> <span style="color: #000000;">        step1();
</span><span style="color: #008080;"> 4</span> <span style="color: #000000;">        step2();
</span><span style="color: #008080;"> 5</span>         
<span style="color: #008080;"> 6</span>         <span style="color: #0000ff;">if</span><span style="color: #000000;"> (isBlahBlah()) {
</span><span style="color: #008080;"> 7</span> <span style="color: #000000;">            step3();
</span><span style="color: #008080;"> 8</span> <span style="color: #000000;">        }
</span><span style="color: #008080;"> 9</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">10</span> 
<span style="color: #008080;">11</span>     <span style="color: #0000ff;">protected</span> <span style="color: #0000ff;">boolean</span><span style="color: #000000;"> isBlahBlah() {
</span><span style="color: #008080;">12</span>         <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">true</span><span style="color: #000000;">;
</span><span style="color: #008080;">13</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">14</span>     
<span style="color: #008080;">15</span>     <span style="color: #0000ff;">protected</span> <span style="color: #0000ff;">abstract</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> step3();
</span><span style="color: #008080;">16</span>     <span style="color: #0000ff;">protected</span> <span style="color: #0000ff;">abstract</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> step2();
</span><span style="color: #008080;">17</span>     <span style="color: #0000ff;">protected</span> <span style="color: #0000ff;">abstract</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> step1();
</span><span style="color: #008080;">18</span> }</pre>
</div>
<span class="cnblogs_code_collapse">抽象父类</span></div>
<p>&nbsp;</p>
<p>之后就可以开始继承扩展了，比如我们写一个子类：</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('99b6cfb8-7eec-4e38-b33a-d07d9e8d5135')"><img id="code_img_closed_99b6cfb8-7eec-4e38-b33a-d07d9e8d5135" class="code_img_closed" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" /><img id="code_img_opened_99b6cfb8-7eec-4e38-b33a-d07d9e8d5135" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('99b6cfb8-7eec-4e38-b33a-d07d9e8d5135',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt="" />
<div id="cnblogs_code_open_99b6cfb8-7eec-4e38-b33a-d07d9e8d5135" class="cnblogs_code_hide">
<pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> ConcreateClass1 <span style="color: #0000ff;">extends</span><span style="color: #000000;"> AbstractClass {
</span><span style="color: #008080;"> 2</span> <span style="color: #000000;">    @Override
</span><span style="color: #008080;"> 3</span>     <span style="color: #0000ff;">protected</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> step3() {
</span><span style="color: #008080;"> 4</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> 不拉不拉</span>
<span style="color: #008080;"> 5</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 6</span> 
<span style="color: #008080;"> 7</span> <span style="color: #000000;">    @Override
</span><span style="color: #008080;"> 8</span>     <span style="color: #0000ff;">protected</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> step2() {
</span><span style="color: #008080;"> 9</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> 不辣不辣</span>
<span style="color: #008080;">10</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">11</span> 
<span style="color: #008080;">12</span> <span style="color: #000000;">    @Override
</span><span style="color: #008080;">13</span>     <span style="color: #0000ff;">protected</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> step1() {
</span><span style="color: #008080;">14</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> 布腊步邋</span>
<span style="color: #008080;">15</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">16</span> }</pre>
</div>
<span class="cnblogs_code_collapse">子类一号</span></div>
<p>子类1直接继承了抽象类实现过的钩子方法，所以执行起来就是依次执行一二三步的方法。</p>
<p>子类1改写了三步方法的实现内容，但是模板方法规定好了的步骤是不会变的。</p>
<p>&nbsp;</p>
<p>然后演示钩子方法的作用，我们写一个子类2：</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('871a45aa-723d-4c45-b150-3ba06a222557')"><img id="code_img_closed_871a45aa-723d-4c45-b150-3ba06a222557" class="code_img_closed" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" /><img id="code_img_opened_871a45aa-723d-4c45-b150-3ba06a222557" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('871a45aa-723d-4c45-b150-3ba06a222557',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt="" />
<div id="cnblogs_code_open_871a45aa-723d-4c45-b150-3ba06a222557" class="cnblogs_code_hide">
<pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> ConcreateClass2 <span style="color: #0000ff;">extends</span><span style="color: #000000;"> AbstractClass {
</span><span style="color: #008080;"> 2</span> 
<span style="color: #008080;"> 3</span> <span style="color: #000000;">    @Override
</span><span style="color: #008080;"> 4</span>     <span style="color: #0000ff;">protected</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> step3() {
</span><span style="color: #008080;"> 5</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> 部喇埠旯</span>
<span style="color: #008080;"> 6</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 7</span> 
<span style="color: #008080;"> 8</span> <span style="color: #000000;">    @Override
</span><span style="color: #008080;"> 9</span>     <span style="color: #0000ff;">protected</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> step2() {
</span><span style="color: #008080;">10</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> 輹蝋鳪嚹</span>
<span style="color: #008080;">11</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">12</span> 
<span style="color: #008080;">13</span> <span style="color: #000000;">    @Override
</span><span style="color: #008080;">14</span>     <span style="color: #0000ff;">protected</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> step1() {
</span><span style="color: #008080;">15</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> булабула</span>
<span style="color: #008080;">16</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">17</span> 
<span style="color: #008080;">18</span> <span style="color: #000000;">    @Override
</span><span style="color: #008080;">19</span>     <span style="color: #0000ff;">protected</span> <span style="color: #0000ff;">boolean</span><span style="color: #000000;"> isBlahBlah() {
</span><span style="color: #008080;">20</span>         <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">false</span><span style="color: #000000;">;
</span><span style="color: #008080;">21</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">22</span> }</pre>
</div>
<span class="cnblogs_code_collapse">子类二号</span></div>
<p>子类2重写了钩子方法，让它返回false，于是在执行子类的模板方法的时候第三步就不会被执行了。</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>虽然写了长长的一大篇，但是其实是很好理解的一种设计模式，简单到我今天一天就没看下一章，模板方法模式是昨天看的。</p>
<p>今天在忙活的事完成了三分之一了，但愿明天能搞出来一个demo。</p>

<div align=right><a href="https://github.com/mlxy/SRBCnblogs"><font size=1>——本文由博客园搬家工具SRBCnblogs转换而成</font></a></div>