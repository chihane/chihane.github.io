---
layout: post
title: 我决定出1.0的时候改名叫OIFaQ
date: 2014-01-17 04:56:00
categories: cnblogs
---

<p>　　不过目前就算了。</p>
<p>&nbsp;</p>
<p>　　练练Socket<span style="text-decoration: line-through;">，还有一点GUI</span>。</p>
<p>　　这次直接用了默认包。</p>
<p>　　原理很简单，客户端想办法搞到用户输入的内容，然后把用户ID和输入内容拿一个数组装起来，然后用ObjectOutputStream送到服务器端。</p>
<p>　　服务器端接到了之后原样拆开，打印一下就行了。</p>
<p>&nbsp;</p>
<p>　　其实我根本不知道聊天程序该怎么实现&hellip;&hellip;每个人都有一份server和一份client？</p>
<p>　　写一点是一点吧&hellip;&hellip;</p>
<p>　　总之之后再学学。</p>
<p>　　另外目前因为用的是TCP，似乎只能一对一，之后再研究研究UDP。</p>
<p>　　</p>
<p>　　Server的输入流名字起错了，不要在意。</p>
<p>　　另外代码这么简单，没有注释也没关系的嘛，是吧。</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('b035ad07-583e-484f-a5bb-7140907aed5f')"><img id="code_img_closed_b035ad07-583e-484f-a5bb-7140907aed5f" class="code_img_closed" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" /><img id="code_img_opened_b035ad07-583e-484f-a5bb-7140907aed5f" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('b035ad07-583e-484f-a5bb-7140907aed5f',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt="" />
<div id="cnblogs_code_open_b035ad07-583e-484f-a5bb-7140907aed5f" class="cnblogs_code_hide">
<pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">import</span> java.io.*<span style="color: #000000;">;
</span><span style="color: #008080;"> 2</span> <span style="color: #0000ff;">import</span> java.net.*<span style="color: #000000;">;
</span><span style="color: #008080;"> 3</span> 
<span style="color: #008080;"> 4</span> <span style="color: #008000;">/**</span><span style="color: #008000;">服务器端，目前是单纯的解包并在命令行打印，下个版本改。
</span><span style="color: #008080;"> 5</span> <span style="color: #008000;"> * 
</span><span style="color: #008080;"> 6</span> <span style="color: #008000;"> * </span><span style="color: #808080;">@author</span><span style="color: #008000;"> mlxy
</span><span style="color: #008080;"> 7</span> <span style="color: #008000;"> * </span><span style="color: #808080;">@version</span><span style="color: #008000;"> 0.4
</span><span style="color: #008080;"> 8</span> <span style="color: #008000;"> * </span><span style="color: #008000;">*/</span>
<span style="color: #008080;"> 9</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> SimChatServer {
</span><span style="color: #008080;">10</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> main(String[] args) {
</span><span style="color: #008080;">11</span>         <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
</span><span style="color: #008080;">12</span>             @SuppressWarnings("resource"<span style="color: #000000;">)
</span><span style="color: #008080;">13</span>             ServerSocket ss = <span style="color: #0000ff;">new</span> ServerSocket(2333<span style="color: #000000;">);
</span><span style="color: #008080;">14</span>             
<span style="color: #008080;">15</span>             System.out.println("Waiting..."<span style="color: #000000;">);
</span><span style="color: #008080;">16</span>             Socket s =<span style="color: #000000;"> ss.accept();
</span><span style="color: #008080;">17</span>             System.out.println("Client connected."<span style="color: #000000;">);
</span><span style="color: #008080;">18</span>             
<span style="color: #008080;">19</span> <span style="color: #000000;">            ObjectInputStream dis;
</span><span style="color: #008080;">20</span>             
<span style="color: #008080;">21</span>             <span style="color: #0000ff;">boolean</span> flag = <span style="color: #0000ff;">true</span><span style="color: #000000;">;
</span><span style="color: #008080;">22</span>             <span style="color: #0000ff;">while</span><span style="color: #000000;">(flag) {
</span><span style="color: #008080;">23</span>                 dis = <span style="color: #0000ff;">new</span><span style="color: #000000;"> ObjectInputStream(s.getInputStream());
</span><span style="color: #008080;">24</span>                 <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
</span><span style="color: #008080;">25</span>                     String[] packReceived =<span style="color: #000000;"> (String[]) dis.readObject();
</span><span style="color: #008080;">26</span>                     System.out.println(packReceived[0] + ": " + packReceived[1<span style="color: #000000;">]);
</span><span style="color: #008080;">27</span> <span style="color: #000000;">                }
</span><span style="color: #008080;">28</span>                 <span style="color: #0000ff;">catch</span> (ClassNotFoundException e) {e.printStackTrace(); System.exit(-1<span style="color: #000000;">);}
</span><span style="color: #008080;">29</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">30</span>             
<span style="color: #008080;">31</span>         } <span style="color: #0000ff;">catch</span><span style="color: #000000;">(IOException e) {
</span><span style="color: #008080;">32</span> <span style="color: #000000;">            e.printStackTrace();
</span><span style="color: #008080;">33</span>             System.exit(-1<span style="color: #000000;">);
</span><span style="color: #008080;">34</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">35</span>         
<span style="color: #008080;">36</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">37</span> }</pre>
</div>
<span class="cnblogs_code_collapse">Server端</span></div>
<div class="cnblogs_code" onclick="cnblogs_code_show('87d56b7a-6c13-43c9-bef2-9213dc4f0c42')"><img id="code_img_closed_87d56b7a-6c13-43c9-bef2-9213dc4f0c42" class="code_img_closed" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" /><img id="code_img_opened_87d56b7a-6c13-43c9-bef2-9213dc4f0c42" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('87d56b7a-6c13-43c9-bef2-9213dc4f0c42',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt="" />
<div id="cnblogs_code_open_87d56b7a-6c13-43c9-bef2-9213dc4f0c42" class="cnblogs_code_hide">
<pre><span style="color: #008080;">  1</span> <span style="color: #0000ff;">import</span> java.awt.*<span style="color: #000000;">;
</span><span style="color: #008080;">  2</span> <span style="color: #0000ff;">import</span> java.awt.event.*<span style="color: #000000;">;
</span><span style="color: #008080;">  3</span> 
<span style="color: #008080;">  4</span> <span style="color: #0000ff;">import</span> javax.swing.*<span style="color: #000000;">;
</span><span style="color: #008080;">  5</span> 
<span style="color: #008080;">  6</span> <span style="color: #0000ff;">import</span> java.io.*<span style="color: #000000;">;
</span><span style="color: #008080;">  7</span> <span style="color: #0000ff;">import</span> java.net.*<span style="color: #000000;">;
</span><span style="color: #008080;">  8</span> 
<span style="color: #008080;">  9</span> <span style="color: #008000;">/**</span><span style="color: #008000;">客户端程序。之后加上打开的时候先弹窗初始化用户ID的功能。
</span><span style="color: #008080;"> 10</span> <span style="color: #008000;"> * 
</span><span style="color: #008080;"> 11</span> <span style="color: #008000;"> * </span><span style="color: #808080;">@author</span><span style="color: #008000;"> mlxy
</span><span style="color: #008080;"> 12</span> <span style="color: #008000;"> * </span><span style="color: #808080;">@version</span><span style="color: #008000;"> 0.7
</span><span style="color: #008080;"> 13</span> <span style="color: #008000;"> * </span><span style="color: #008000;">*/</span>
<span style="color: #008080;"> 14</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> SimChatClient <span style="color: #0000ff;">extends</span><span style="color: #000000;"> JFrame {
</span><span style="color: #008080;"> 15</span>     <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">final</span> <span style="color: #0000ff;">long</span> serialVersionUID = 1685352502599359548L<span style="color: #000000;">;
</span><span style="color: #008080;"> 16</span>     <span style="color: #0000ff;">private</span><span style="color: #000000;"> JPanel panel;
</span><span style="color: #008080;"> 17</span>     <span style="color: #0000ff;">private</span><span style="color: #000000;"> JTextArea area;
</span><span style="color: #008080;"> 18</span>     <span style="color: #0000ff;">private</span><span style="color: #000000;"> JTextField field;
</span><span style="color: #008080;"> 19</span>     <span style="color: #0000ff;">private</span><span style="color: #000000;"> String userID;
</span><span style="color: #008080;"> 20</span>     <span style="color: #0000ff;">private</span> StringBuffer chatRecord = <span style="color: #0000ff;">new</span> StringBuffer(""<span style="color: #000000;">);
</span><span style="color: #008080;"> 21</span>     
<span style="color: #008080;"> 22</span>     <span style="color: #0000ff;">private</span><span style="color: #000000;"> Socket socket;
</span><span style="color: #008080;"> 23</span>     <span style="color: #0000ff;">private</span><span style="color: #000000;"> ObjectOutputStream oos;
</span><span style="color: #008080;"> 24</span>     
<span style="color: #008080;"> 25</span>     <span style="color: #008000;">/**</span><span style="color: #008000;">默认构造方法，初始化用户ID及框架内容。</span><span style="color: #008000;">*/</span>
<span style="color: #008080;"> 26</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> SimChatClient() {
</span><span style="color: #008080;"> 27</span>         <span style="color: #0000ff;">try</span> {socket = <span style="color: #0000ff;">new</span> Socket("192.168.1.104", 2333<span style="color: #000000;">);}
</span><span style="color: #008080;"> 28</span>         <span style="color: #0000ff;">catch</span>(IOException e) {e.printStackTrace(); System.out.println(-1<span style="color: #000000;">);}
</span><span style="color: #008080;"> 29</span>         
<span style="color: #008080;"> 30</span>         setUserID("Default User"<span style="color: #000000;">);
</span><span style="color: #008080;"> 31</span>         
<span style="color: #008080;"> 32</span>         panel = <span style="color: #0000ff;">new</span><span style="color: #000000;"> JPanel();
</span><span style="color: #008080;"> 33</span>         panel.setLayout(<span style="color: #0000ff;">new</span><span style="color: #000000;"> BorderLayout());
</span><span style="color: #008080;"> 34</span> 
<span style="color: #008080;"> 35</span>         area = <span style="color: #0000ff;">new</span><span style="color: #000000;"> JTextArea();
</span><span style="color: #008080;"> 36</span>         area.setLineWrap(<span style="color: #0000ff;">true</span><span style="color: #000000;">);
</span><span style="color: #008080;"> 37</span>         area.setWrapStyleWord(<span style="color: #0000ff;">true</span><span style="color: #000000;">);
</span><span style="color: #008080;"> 38</span>         area.setEditable(<span style="color: #0000ff;">false</span><span style="color: #000000;">);
</span><span style="color: #008080;"> 39</span>         area.setBackground(<span style="color: #0000ff;">new</span> Color(255, 204, 255<span style="color: #000000;">));
</span><span style="color: #008080;"> 40</span>         JScrollPane scrollPane = <span style="color: #0000ff;">new</span><span style="color: #000000;"> JScrollPane(area);
</span><span style="color: #008080;"> 41</span>         
<span style="color: #008080;"> 42</span>         field = <span style="color: #0000ff;">new</span><span style="color: #000000;"> JTextField();
</span><span style="color: #008080;"> 43</span>         field.setBackground(<span style="color: #0000ff;">new</span> Color(66, 204, 255<span style="color: #000000;">));
</span><span style="color: #008080;"> 44</span>         field.addActionListener(<span style="color: #0000ff;">new</span><span style="color: #000000;"> FieldListener());
</span><span style="color: #008080;"> 45</span>         
<span style="color: #008080;"> 46</span> <span style="color: #000000;">        panel.add(scrollPane, BorderLayout.CENTER);
</span><span style="color: #008080;"> 47</span> <span style="color: #000000;">        panel.add(field, BorderLayout.SOUTH);
</span><span style="color: #008080;"> 48</span>         
<span style="color: #008080;"> 49</span>         <span style="color: #0000ff;">this</span><span style="color: #000000;">.add(panel);
</span><span style="color: #008080;"> 50</span>         <span style="color: #0000ff;">this</span>.addWindowListener(<span style="color: #0000ff;">new</span><span style="color: #000000;"> WindowAdapter() {
</span><span style="color: #008080;"> 51</span> <span style="color: #000000;">            @Override
</span><span style="color: #008080;"> 52</span>             <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> windowActivated(WindowEvent e) {
</span><span style="color: #008080;"> 53</span>                 <span style="color: #0000ff;">super</span><span style="color: #000000;">.windowActivated(e);
</span><span style="color: #008080;"> 54</span> <span style="color: #000000;">                field.requestFocusInWindow();
</span><span style="color: #008080;"> 55</span> <span style="color: #000000;">            }
</span><span style="color: #008080;"> 56</span> <span style="color: #000000;">        });
</span><span style="color: #008080;"> 57</span>         <span style="color: #008000;">//</span><span style="color: #008000;">this.pack();</span>
<span style="color: #008080;"> 58</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 59</span>     
<span style="color: #008080;"> 60</span>     <span style="color: #008000;">/**</span><span style="color: #008000;">自定义用户ID的构造方法。</span><span style="color: #008000;">*/</span>
<span style="color: #008080;"> 61</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> SimChatClient(String userID) {
</span><span style="color: #008080;"> 62</span>         <span style="color: #0000ff;">this</span><span style="color: #000000;">();
</span><span style="color: #008080;"> 63</span>         <span style="color: #0000ff;">this</span><span style="color: #000000;">.setUserID(userID);
</span><span style="color: #008080;"> 64</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 65</span>     
<span style="color: #008080;"> 66</span>     <span style="color: #008000;">/**</span><span style="color: #008000;">主运行方法。</span><span style="color: #008000;">*/</span>
<span style="color: #008080;"> 67</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> main(String[] args) {
</span><span style="color: #008080;"> 68</span>         <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
</span><span style="color: #008080;"> 69</span>             UIManager.setLookAndFeel("com.sun.java.swing.plaf.nimbus.NimbusLookAndFeel"<span style="color: #000000;">);
</span><span style="color: #008080;"> 70</span>         } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (UnsupportedLookAndFeelException e) {
</span><span style="color: #008080;"> 71</span> <span style="color: #000000;">            e.printStackTrace();
</span><span style="color: #008080;"> 72</span>         } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (ClassNotFoundException e) {
</span><span style="color: #008080;"> 73</span> <span style="color: #000000;">            e.printStackTrace();
</span><span style="color: #008080;"> 74</span>         } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (InstantiationException e) {
</span><span style="color: #008080;"> 75</span> <span style="color: #000000;">            e.printStackTrace();
</span><span style="color: #008080;"> 76</span>         } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (IllegalAccessException e) {
</span><span style="color: #008080;"> 77</span> <span style="color: #000000;">            e.printStackTrace();
</span><span style="color: #008080;"> 78</span> <span style="color: #000000;">        }
</span><span style="color: #008080;"> 79</span>         
<span style="color: #008080;"> 80</span> <span style="color: #000000;">        launchFrame();
</span><span style="color: #008080;"> 81</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 82</span>     
<span style="color: #008080;"> 83</span>     <span style="color: #008000;">/**</span><span style="color: #008000;">框架参数初始化。</span><span style="color: #008000;">*/</span>
<span style="color: #008080;"> 84</span>     <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> launchFrame() {
</span><span style="color: #008080;"> 85</span>         SimChatClient frame = <span style="color: #0000ff;">new</span> SimChatClient("mlxy"<span style="color: #000000;">);
</span><span style="color: #008080;"> 86</span>         
<span style="color: #008080;"> 87</span>         frame.setTitle("Simple Chat Online"<span style="color: #000000;">);
</span><span style="color: #008080;"> 88</span>         frame.setSize(300, 400<span style="color: #000000;">);
</span><span style="color: #008080;"> 89</span> <span style="color: #000000;">        frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
</span><span style="color: #008080;"> 90</span>         frame.setLocationRelativeTo(<span style="color: #0000ff;">null</span><span style="color: #000000;">);
</span><span style="color: #008080;"> 91</span>         frame.setVisible(<span style="color: #0000ff;">true</span><span style="color: #000000;">);
</span><span style="color: #008080;"> 92</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 93</span>     
<span style="color: #008080;"> 94</span>     <span style="color: #008000;">/**</span><span style="color: #008000;">输入框的监听器。</span><span style="color: #008000;">*/</span>
<span style="color: #008080;"> 95</span>     <span style="color: #0000ff;">class</span> FieldListener <span style="color: #0000ff;">implements</span><span style="color: #000000;"> ActionListener {
</span><span style="color: #008080;"> 96</span>         
<span style="color: #008080;"> 97</span> <span style="color: #000000;">        @Override
</span><span style="color: #008080;"> 98</span>         <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> actionPerformed(ActionEvent e) {
</span><span style="color: #008080;"> 99</span>             <span style="color: #008000;">//</span><span style="color: #008000;">向服务器发送包。</span>
<span style="color: #008080;">100</span>             String[] packToSend =<span style="color: #000000;"> {userID, field.getText()};
</span><span style="color: #008080;">101</span>             <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
</span><span style="color: #008080;">102</span>                 oos = <span style="color: #0000ff;">new</span><span style="color: #000000;"> ObjectOutputStream(socket.getOutputStream());
</span><span style="color: #008080;">103</span> <span style="color: #000000;">                oos.writeObject(packToSend);
</span><span style="color: #008080;">104</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">105</span>             <span style="color: #0000ff;">catch</span> (IOException ex) {ex.printStackTrace(); System.exit(-1<span style="color: #000000;">);}
</span><span style="color: #008080;">106</span>             
<span style="color: #008080;">107</span>             <span style="color: #008000;">//</span><span style="color: #008000;">更新单机窗口内容。###之后加上发送时间。</span>
<span style="color: #008080;">108</span>             chatRecord.append(userID + ": " + field.getText() + "\n"<span style="color: #000000;">);
</span><span style="color: #008080;">109</span> <span style="color: #000000;">            area.setText(chatRecord.toString());
</span><span style="color: #008080;">110</span>             field.setText(""<span style="color: #000000;">);
</span><span style="color: #008080;">111</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">112</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">113</span> 
<span style="color: #008080;">114</span>     <span style="color: #0000ff;">public</span> String getUserID() {<span style="color: #0000ff;">return</span><span style="color: #000000;"> userID;}
</span><span style="color: #008080;">115</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> setUserID(String userID) {<span style="color: #0000ff;">this</span>.userID =<span style="color: #000000;"> userID;}
</span><span style="color: #008080;">116</span> }</pre>
</div>
<span class="cnblogs_code_collapse">Client端</span></div>
<p>&nbsp;</p>

<p align=right><span style="font-size: 12px">——本文由博客园搬家工具<a href="https://github.com/mlxy/SRBCnblogs">SRBCnblogs</a>转换而成</span></p>