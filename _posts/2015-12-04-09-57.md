---
layout: post
title: Kotlin有点用力过猛了
date: 2015-12-04 09:57:00
categories: cnblogs
---

<div class="cnblogs_code">
<pre><span style="color: #0000ff;">public</span> fun readBlogHtml(blog: String) : Observable&lt;String&gt;<span style="color: #000000;"> {
    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> Observable.just(blog)
                    .map{ blog </span>-&gt;<span style="color: #000000;"> assembleUrl(blog) }
                    .flatMap { url </span>-&gt;<span style="color: #000000;"> readHtml(url) }
}</span></pre>
</div>
<p>搞得我有点迷乱&hellip;&hellip;</p>
<p>&nbsp;</p>
<p>而且其实flatMap是不需要的，因为Kotlin读网页源码就一句话&hellip;&hellip;</p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff;">public</span> fun readHtml(url: String) : Observable&lt;String&gt;<span style="color: #000000;"> {
    </span><span style="color: #0000ff;">return</span> Observable.create&lt;String&gt;<span style="color: #000000;"> {
        subscriber </span>-&gt;<span style="color: #000000;"> subscriber.onNext(URL(url).readText()); subscriber.onCompleted()
    }
}</span></pre>
</div>
<p>&nbsp;</p>
<p>还不如不用Observable&hellip;&hellip;</p>
<p>&nbsp;</p>
<p>于是就进一步变成了这样：</p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff;">public</span> fun readBlogHtml(blog: String) : Observable&lt;String&gt; =<span style="color: #000000;"> Observable.just(blog)
                    .map { blog </span>-&gt;<span style="color: #000000;"> assembleUrl(blog) }
                    .map { url </span>-&gt;<span style="color: #000000;"> readHtml(url) }

</span><span style="color: #0000ff;">private</span> fun assembleUrl(blog: String?): String = "http://$blog.tumblr.com/page/"

<span style="color: #0000ff;">public</span> fun readHtml(url: String) : String = URL(url).readText()</pre>
</div>
<p>&nbsp;</p>
<p>这代码还要不要写了？</p>
<p>啊？</p>
<p>&nbsp;</p>
<p>RxJava都不用了&hellip;&hellip;</p>
<p>&nbsp;</p>
<p>可以变成这样：</p>
<div class="cnblogs_code">
<pre><span style="color: #000000;">fun test() {
    async {
        val html </span>= readBlogHtml("blog"<span style="color: #000000;">)
        uiThread { update(html) }
    }
}

</span><span style="color: #0000ff;">public</span> fun readBlogHtml(blog: String) : String =<span style="color: #000000;"> readHtml(assembleUrl(blog))

</span><span style="color: #0000ff;">private</span> fun assembleUrl(blog: String?): String = "http://$blog.tumblr.com/page/"

<span style="color: #0000ff;">public</span> fun readHtml(url: String) : String = URL(url).readText()</pre>
</div>
<p>&nbsp;</p>
<p>啊？？</p>

<div align=right><a href="https://github.com/mlxy"><font size=1>——本文由博客园搬家工具SRBCnblogs转换而成</font></a></div>