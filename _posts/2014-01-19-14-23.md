---
layout: post
title: 就这样吧
date: 2014-01-19 14:23:00
categories: cnblogs
---

<p>　　<span style="text-decoration: line-through;">bug基本解决了，用两台电脑加上hamachi测试了一下，能用。</span></p>
<p>　　干，刚说完拿自己的外网IP测试了一下，报空指针异常，懒得改了。理由大概是虽然连不上服务器的IP会报错，但是其实你随便连个谁的IP也能连上，所以程序还会执行下去，但是因为对面没有人给你接收，发包没人接，就 报错了。</p>
<p>　　我猜的。</p>
<p>　　有外网服务器当然更好，没有就只能挂hamachi或者用内网映射什么的我不懂的东西。</p>
<p>　　</p>
<p>　　分成两个部分，随便哪台机器运行OIFaQ-Server启动服务器，是第三者的机器也无所谓。</p>
<p>　　然后用户启动OIFaQ-Client就完事了。</p>
<p>&nbsp;</p>
<p>　　还是挺直观的。</p>
<p>&nbsp;</p>
<p>　　<a href="http://files.cnblogs.com/JavaForNow/OIFaQV1.1.rar">OIFaQV1.1.rar</a></p>
<p>　　惯例发一下代码，就这样吧，将来重构：</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('2b367ec5-2771-4bf8-ab26-1333a4646ebf')"><img id="code_img_closed_2b367ec5-2771-4bf8-ab26-1333a4646ebf" class="code_img_closed" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" /><img id="code_img_opened_2b367ec5-2771-4bf8-ab26-1333a4646ebf" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('2b367ec5-2771-4bf8-ab26-1333a4646ebf',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt="" />
<div id="cnblogs_code_open_2b367ec5-2771-4bf8-ab26-1333a4646ebf" class="cnblogs_code_hide">
<pre><span style="color: #008080;">  1</span> <span style="color: #0000ff;">import</span> java.io.*<span style="color: #000000;">;
</span><span style="color: #008080;">  2</span> <span style="color: #0000ff;">import</span> java.net.*<span style="color: #000000;">;
</span><span style="color: #008080;">  3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.ArrayList;
</span><span style="color: #008080;">  4</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.awt.BorderLayout;
</span><span style="color: #008080;">  5</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.awt.Color;
</span><span style="color: #008080;">  6</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.awt.Dimension;
</span><span style="color: #008080;">  7</span> 
<span style="color: #008080;">  8</span> <span style="color: #0000ff;">import</span> javax.swing.*<span style="color: #000000;">;
</span><span style="color: #008080;">  9</span> 
<span style="color: #008080;"> 10</span> <span style="color: #008000;">/**</span>
<span style="color: #008080;"> 11</span> <span style="color: #008000;"> * 服务器端。
</span><span style="color: #008080;"> 12</span> <span style="color: #008000;"> * 增加了GUI来显示服务器日志。
</span><span style="color: #008080;"> 13</span> <span style="color: #008000;"> * 
</span><span style="color: #008080;"> 14</span> <span style="color: #008000;"> * </span><span style="color: #808080;">@author</span><span style="color: #008000;"> mlxy
</span><span style="color: #008080;"> 15</span> <span style="color: #008000;"> * </span><span style="color: #808080;">@version</span><span style="color: #008000;"> 1.1
</span><span style="color: #008080;"> 16</span> <span style="color: #008000;"> * </span><span style="color: #008000;">*/</span>
<span style="color: #008080;"> 17</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> SimChatServer <span style="color: #0000ff;">extends</span><span style="color: #000000;"> JFrame {
</span><span style="color: #008080;"> 18</span>     <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">final</span> <span style="color: #0000ff;">long</span> serialVersionUID = 1L<span style="color: #000000;">;
</span><span style="color: #008080;"> 19</span>     ServerSocket ss = <span style="color: #0000ff;">null</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 20</span>     ArrayList&lt;Client&gt; clients = <span style="color: #0000ff;">null</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 21</span>     
<span style="color: #008080;"> 22</span>     JTextArea log = <span style="color: #0000ff;">null</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 23</span> <span style="color: #000000;">    JScrollPane scrollPane;
</span><span style="color: #008080;"> 24</span>     
<span style="color: #008080;"> 25</span>     <span style="color: #008000;">/**</span><span style="color: #008000;"> 服务器构造方法。</span><span style="color: #008000;">*/</span>
<span style="color: #008080;"> 26</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> SimChatServer() {
</span><span style="color: #008080;"> 27</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> 初始化已连接客户端列表。</span>
<span style="color: #008080;"> 28</span>         clients = <span style="color: #0000ff;">new</span> ArrayList&lt;Client&gt;<span style="color: #000000;">();
</span><span style="color: #008080;"> 29</span>         
<span style="color: #008080;"> 30</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> 初始化框架内容。</span>
<span style="color: #008080;"> 31</span>         JPanel mainPanel = <span style="color: #0000ff;">new</span><span style="color: #000000;"> JPanel();
</span><span style="color: #008080;"> 32</span>         mainPanel.setLayout(<span style="color: #0000ff;">new</span><span style="color: #000000;"> BorderLayout());
</span><span style="color: #008080;"> 33</span>         mainPanel.setPreferredSize(<span style="color: #0000ff;">new</span> Dimension(400, 500<span style="color: #000000;">));
</span><span style="color: #008080;"> 34</span>         
<span style="color: #008080;"> 35</span>         log = <span style="color: #0000ff;">new</span><span style="color: #000000;"> JTextArea();
</span><span style="color: #008080;"> 36</span>         log.setBackground(<span style="color: #0000ff;">new</span> Color(66, 204, 255<span style="color: #000000;">));
</span><span style="color: #008080;"> 37</span>         log.setEditable(<span style="color: #0000ff;">false</span><span style="color: #000000;">);
</span><span style="color: #008080;"> 38</span>         log.setLineWrap(<span style="color: #0000ff;">true</span><span style="color: #000000;">);
</span><span style="color: #008080;"> 39</span>         log.setWrapStyleWord(<span style="color: #0000ff;">true</span><span style="color: #000000;">);
</span><span style="color: #008080;"> 40</span>         
<span style="color: #008080;"> 41</span>         scrollPane = <span style="color: #0000ff;">new</span><span style="color: #000000;"> JScrollPane(log);
</span><span style="color: #008080;"> 42</span>         
<span style="color: #008080;"> 43</span> <span style="color: #000000;">        mainPanel.add(scrollPane, BorderLayout.CENTER);
</span><span style="color: #008080;"> 44</span> <span style="color: #000000;">        add(mainPanel);
</span><span style="color: #008080;"> 45</span> <span style="color: #000000;">        pack();
</span><span style="color: #008080;"> 46</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 47</span>     
<span style="color: #008080;"> 48</span>     <span style="color: #008000;">/**</span><span style="color: #008000;"> 主方法。</span><span style="color: #008000;">*/</span>
<span style="color: #008080;"> 49</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> main(String[] args) {
</span><span style="color: #008080;"> 50</span>         <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
</span><span style="color: #008080;"> 51</span>             UIManager.setLookAndFeel("com.sun.java.swing.plaf.nimbus.NimbusLookAndFeel"<span style="color: #000000;">);
</span><span style="color: #008080;"> 52</span>         } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (UnsupportedLookAndFeelException e) {
</span><span style="color: #008080;"> 53</span> <span style="color: #000000;">            e.printStackTrace();
</span><span style="color: #008080;"> 54</span>         } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (ClassNotFoundException e) {
</span><span style="color: #008080;"> 55</span> <span style="color: #000000;">            e.printStackTrace();
</span><span style="color: #008080;"> 56</span>         } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (InstantiationException e) {
</span><span style="color: #008080;"> 57</span> <span style="color: #000000;">            e.printStackTrace();
</span><span style="color: #008080;"> 58</span>         } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (IllegalAccessException e) {
</span><span style="color: #008080;"> 59</span> <span style="color: #000000;">            e.printStackTrace();
</span><span style="color: #008080;"> 60</span> <span style="color: #000000;">        }
</span><span style="color: #008080;"> 61</span>         
<span style="color: #008080;"> 62</span>         SimChatServer server = <span style="color: #0000ff;">new</span><span style="color: #000000;"> SimChatServer();
</span><span style="color: #008080;"> 63</span> <span style="color: #000000;">        server.launchFrame();
</span><span style="color: #008080;"> 64</span> <span style="color: #000000;">        server.startUp();
</span><span style="color: #008080;"> 65</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 66</span>     
<span style="color: #008080;"> 67</span>     <span style="color: #008000;">/**</span><span style="color: #008000;"> 初始化框架。</span><span style="color: #008000;">*/</span>
<span style="color: #008080;"> 68</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> launchFrame() {
</span><span style="color: #008080;"> 69</span>         setTitle("OIFaQ服务端日志"<span style="color: #000000;">);
</span><span style="color: #008080;"> 70</span> <span style="color: #000000;">        setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
</span><span style="color: #008080;"> 71</span>         setLocationRelativeTo(<span style="color: #0000ff;">null</span><span style="color: #000000;">);
</span><span style="color: #008080;"> 72</span>         setVisible(<span style="color: #0000ff;">true</span><span style="color: #000000;">);
</span><span style="color: #008080;"> 73</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 74</span>     
<span style="color: #008080;"> 75</span>     <span style="color: #008000;">/**</span><span style="color: #008000;"> 启动服务器。</span><span style="color: #008000;">*/</span>
<span style="color: #008080;"> 76</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> startUp() {
</span><span style="color: #008080;"> 77</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> 尝试启动服务器，端口被占用则弹窗提示并退出。</span>
<span style="color: #008080;"> 78</span>         <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
</span><span style="color: #008080;"> 79</span>             ss = <span style="color: #0000ff;">new</span> ServerSocket(2333<span style="color: #000000;">);
</span><span style="color: #008080;"> 80</span>         } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (BindException e) {
</span><span style="color: #008080;"> 81</span>             JOptionPane.showMessageDialog(<span style="color: #0000ff;">null</span><span style="color: #000000;">,
</span><span style="color: #008080;"> 82</span>                     "Port occupied.", "Error"<span style="color: #000000;">, JOptionPane.WARNING_MESSAGE);
</span><span style="color: #008080;"> 83</span>             System.exit(0<span style="color: #000000;">);
</span><span style="color: #008080;"> 84</span>         } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (IOException ex) {
</span><span style="color: #008080;"> 85</span> <span style="color: #000000;">            ex.printStackTrace();
</span><span style="color: #008080;"> 86</span> <span style="color: #000000;">        }
</span><span style="color: #008080;"> 87</span> 
<span style="color: #008080;"> 88</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> 死循环，等待客户端连接，连接成功则启动一个新线程。</span>
<span style="color: #008080;"> 89</span>         <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
</span><span style="color: #008080;"> 90</span>             <span style="color: #0000ff;">while</span> (<span style="color: #0000ff;">true</span><span style="color: #000000;">) {
</span><span style="color: #008080;"> 91</span>                 Client newClient = <span style="color: #0000ff;">new</span><span style="color: #000000;"> Client(ss.accept());
</span><span style="color: #008080;"> 92</span> <span style="color: #000000;">                newClient.start();
</span><span style="color: #008080;"> 93</span> <span style="color: #000000;">                clients.add(newClient);
</span><span style="color: #008080;"> 94</span>                 updateLog("Current clients: " +<span style="color: #000000;"> clients.size());
</span><span style="color: #008080;"> 95</span> <span style="color: #000000;">            }
</span><span style="color: #008080;"> 96</span>         } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (IOException e) {
</span><span style="color: #008080;"> 97</span> <span style="color: #000000;">            e.printStackTrace();
</span><span style="color: #008080;"> 98</span> <span style="color: #000000;">        }
</span><span style="color: #008080;"> 99</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">100</span>     
<span style="color: #008080;">101</span>     <span style="color: #008000;">/**</span>
<span style="color: #008080;">102</span> <span style="color: #008000;">     * 内部类。
</span><span style="color: #008080;">103</span> <span style="color: #008000;">     * 单个客户端线程，包含了处理客户端发来信息的功能，以及向客户端发送信息的方法。
</span><span style="color: #008080;">104</span> <span style="color: #008000;">     * 
</span><span style="color: #008080;">105</span> <span style="color: #008000;">     * </span><span style="color: #808080;">@author</span><span style="color: #008000;"> mlxy
</span><span style="color: #008080;">106</span> <span style="color: #008000;">     * </span><span style="color: #808080;">@version</span><span style="color: #008000;"> 1.0
</span><span style="color: #008080;">107</span>      <span style="color: #008000;">*/</span>
<span style="color: #008080;">108</span>     <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">class</span> Client <span style="color: #0000ff;">extends</span><span style="color: #000000;"> Thread {
</span><span style="color: #008080;">109</span> <span style="color: #000000;">        Socket singleSocket;
</span><span style="color: #008080;">110</span> <span style="color: #000000;">        ObjectInputStream singleInput;
</span><span style="color: #008080;">111</span> <span style="color: #000000;">        ObjectOutputStream singleOutput;
</span><span style="color: #008080;">112</span>         
<span style="color: #008080;">113</span>         <span style="color: #008000;">/**</span><span style="color: #008000;"> 一个客户端线程的构造方法。</span><span style="color: #008000;">*/</span>
<span style="color: #008080;">114</span>         <span style="color: #0000ff;">public</span><span style="color: #000000;"> Client(Socket singleSocket) {
</span><span style="color: #008080;">115</span>             <span style="color: #0000ff;">this</span>.singleSocket =<span style="color: #000000;"> singleSocket;
</span><span style="color: #008080;">116</span>             updateLog("Client connected."<span style="color: #000000;">);
</span><span style="color: #008080;">117</span>             <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
</span><span style="color: #008080;">118</span>                 singleInput = <span style="color: #0000ff;">new</span><span style="color: #000000;"> ObjectInputStream(singleSocket.getInputStream());
</span><span style="color: #008080;">119</span>                 singleOutput = <span style="color: #0000ff;">new</span><span style="color: #000000;"> ObjectOutputStream(singleSocket.getOutputStream());
</span><span style="color: #008080;">120</span>             } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (IOException e) {
</span><span style="color: #008080;">121</span> <span style="color: #000000;">                e.printStackTrace();
</span><span style="color: #008080;">122</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">123</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">124</span> 
<span style="color: #008080;">125</span> <span style="color: #000000;">        @Override
</span><span style="color: #008080;">126</span>         <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> run() {
</span><span style="color: #008080;">127</span>             <span style="color: #008000;">//</span><span style="color: #008000;"> 主运行部分，抓到客户端退出的异常就打印提示并退出。</span>
<span style="color: #008080;">128</span>             <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
</span><span style="color: #008080;">129</span>                 <span style="color: #008000;">//</span><span style="color: #008000;"> 死循环，读包拆包打印。</span>
<span style="color: #008080;">130</span>                 <span style="color: #0000ff;">while</span> (<span style="color: #0000ff;">true</span><span style="color: #000000;">) {
</span><span style="color: #008080;">131</span>                     String[] packReceived =<span style="color: #000000;"> (String[]) singleInput.readObject();
</span><span style="color: #008080;">132</span>                     updateLog("[" + packReceived[0] + "]: " + packReceived[1<span style="color: #000000;">]);
</span><span style="color: #008080;">133</span>                     <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">int</span> i = 0; i &lt; clients.size(); i++<span style="color: #000000;">) {
</span><span style="color: #008080;">134</span> <span style="color: #000000;">                        clients.get(i).sendPackage(packReceived);
</span><span style="color: #008080;">135</span> <span style="color: #000000;">                    }
</span><span style="color: #008080;">136</span> <span style="color: #000000;">                }
</span><span style="color: #008080;">137</span>                 
<span style="color: #008080;">138</span>             } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (ClassNotFoundException e) {
</span><span style="color: #008080;">139</span> <span style="color: #000000;">                e.printStackTrace();
</span><span style="color: #008080;">140</span>             } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (EOFException ex) {
</span><span style="color: #008080;">141</span>                 updateLog("Client disconnected."<span style="color: #000000;">);
</span><span style="color: #008080;">142</span>             } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (IOException exc) {
</span><span style="color: #008080;">143</span> <span style="color: #000000;">                exc.printStackTrace();
</span><span style="color: #008080;">144</span>             } <span style="color: #0000ff;">finally</span><span style="color: #000000;"> {
</span><span style="color: #008080;">145</span>                 <span style="color: #008000;">//</span><span style="color: #008000;"> 进程准备结束，释放相关资源。</span>
<span style="color: #008080;">146</span>                 <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
</span><span style="color: #008080;">147</span>                     <span style="color: #0000ff;">if</span> (singleSocket != <span style="color: #0000ff;">null</span><span style="color: #000000;">)
</span><span style="color: #008080;">148</span> <span style="color: #000000;">                        singleSocket.close();
</span><span style="color: #008080;">149</span>                     <span style="color: #0000ff;">if</span> (singleInput != <span style="color: #0000ff;">null</span><span style="color: #000000;">)
</span><span style="color: #008080;">150</span> <span style="color: #000000;">                        singleInput.close();
</span><span style="color: #008080;">151</span>                     <span style="color: #0000ff;">if</span> (singleOutput != <span style="color: #0000ff;">null</span><span style="color: #000000;">)
</span><span style="color: #008080;">152</span> <span style="color: #000000;">                        singleOutput.close();
</span><span style="color: #008080;">153</span>                     
<span style="color: #008080;">154</span>                     <span style="color: #008000;">//</span><span style="color: #008000;"> 报告当前客户端退出。</span>
<span style="color: #008080;">155</span> <span style="color: #000000;">                    clientOut();
</span><span style="color: #008080;">156</span>                 } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (IOException e) {
</span><span style="color: #008080;">157</span> <span style="color: #000000;">                    e.printStackTrace();
</span><span style="color: #008080;">158</span> <span style="color: #000000;">                }
</span><span style="color: #008080;">159</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">160</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">161</span>         
<span style="color: #008080;">162</span>         <span style="color: #008000;">/**</span><span style="color: #008000;"> 向客户端发包的方法。</span><span style="color: #008000;">*/</span>
<span style="color: #008080;">163</span>         <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> sendPackage(Object o) {
</span><span style="color: #008080;">164</span>             <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
</span><span style="color: #008080;">165</span> <span style="color: #000000;">                singleOutput.writeObject(o);
</span><span style="color: #008080;">166</span> <span style="color: #000000;">                singleOutput.flush();
</span><span style="color: #008080;">167</span>             } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (IOException e) {
</span><span style="color: #008080;">168</span> <span style="color: #000000;">                e.printStackTrace();
</span><span style="color: #008080;">169</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">170</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">171</span>         
<span style="color: #008080;">172</span>         <span style="color: #008000;">/**</span><span style="color: #008000;"> 管理客户端退出的方法。</span><span style="color: #008000;">*/</span>
<span style="color: #008080;">173</span>         <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> clientOut() {
</span><span style="color: #008080;">174</span>             <span style="color: #008000;">/*</span>
<span style="color: #008080;">175</span> <span style="color: #008000;">            // 找出当前客户端所在下标并标记删除。不能一边遍历一边修改列表哇，同志。
</span><span style="color: #008080;">176</span> <span style="color: #008000;">            int indexToRemove = -1;
</span><span style="color: #008080;">177</span> <span style="color: #008000;">            for (int i = 0; i &lt; clients.size(); i++) {
</span><span style="color: #008080;">178</span> <span style="color: #008000;">                if (clients.get(i).equals(this)) {
</span><span style="color: #008080;">179</span> <span style="color: #008000;">                    indexToRemove = i;
</span><span style="color: #008080;">180</span> <span style="color: #008000;">                    break;
</span><span style="color: #008080;">181</span> <span style="color: #008000;">                }
</span><span style="color: #008080;">182</span> <span style="color: #008000;">            }
</span><span style="color: #008080;">183</span> <span style="color: #008000;">            clients.remove(indexToRemove);
</span><span style="color: #008080;">184</span>             <span style="color: #008000;">*/</span>
<span style="color: #008080;">185</span>             
<span style="color: #008080;">186</span>             <span style="color: #008000;">//</span><span style="color: #008000;"> 同志我跟你讲，你看着像个呆逼。</span>
<span style="color: #008080;">187</span>             clients.remove(<span style="color: #0000ff;">this</span><span style="color: #000000;">);
</span><span style="color: #008080;">188</span>             updateLog("Current clients: " +<span style="color: #000000;"> clients.size());
</span><span style="color: #008080;">189</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">190</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">191</span>     
<span style="color: #008080;">192</span>     <span style="color: #008000;">/**</span><span style="color: #008000;"> 把一个字符串追加到当前日志内容的末尾。</span><span style="color: #008000;">*/</span>
<span style="color: #008080;">193</span>     <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> updateLog(String s) {
</span><span style="color: #008080;">194</span>         log.setText(log.getText() + s + "\n"<span style="color: #000000;">);
</span><span style="color: #008080;">195</span>         JScrollBar tempBar =<span style="color: #000000;"> scrollPane.getVerticalScrollBar();
</span><span style="color: #008080;">196</span> <span style="color: #000000;">        tempBar.setValue(tempBar.getMaximum());
</span><span style="color: #008080;">197</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">198</span> }</pre>
</div>
<span class="cnblogs_code_collapse">Server</span></div>
<div class="cnblogs_code" onclick="cnblogs_code_show('ea7f9de4-3f22-40eb-9fec-a5cffdb1ebc4')"><img id="code_img_closed_ea7f9de4-3f22-40eb-9fec-a5cffdb1ebc4" class="code_img_closed" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" /><img id="code_img_opened_ea7f9de4-3f22-40eb-9fec-a5cffdb1ebc4" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('ea7f9de4-3f22-40eb-9fec-a5cffdb1ebc4',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt="" />
<div id="cnblogs_code_open_ea7f9de4-3f22-40eb-9fec-a5cffdb1ebc4" class="cnblogs_code_hide">
<pre><span style="color: #008080;">  1</span> <span style="color: #0000ff;">import</span> java.awt.*<span style="color: #000000;">;
</span><span style="color: #008080;">  2</span> <span style="color: #0000ff;">import</span> java.awt.event.*<span style="color: #000000;">;
</span><span style="color: #008080;">  3</span> 
<span style="color: #008080;">  4</span> <span style="color: #0000ff;">import</span> javax.swing.*<span style="color: #000000;">;
</span><span style="color: #008080;">  5</span> 
<span style="color: #008080;">  6</span> <span style="color: #0000ff;">import</span> java.io.*<span style="color: #000000;">;
</span><span style="color: #008080;">  7</span> <span style="color: #0000ff;">import</span> java.net.*<span style="color: #000000;">;
</span><span style="color: #008080;">  8</span> 
<span style="color: #008080;">  9</span> <span style="color: #008000;">/**</span>
<span style="color: #008080;"> 10</span> <span style="color: #008000;"> * 客户端程序。
</span><span style="color: #008080;"> 11</span> <span style="color: #008000;"> * 修改了更新文本框内容的方法，删掉了用来存储内容的StringBuffer，改为动态更新。
</span><span style="color: #008080;"> 12</span> <span style="color: #008000;"> * 在服务器未启动的情况下启动客户端会弹窗报错并退出。
</span><span style="color: #008080;"> 13</span> <span style="color: #008000;"> * ServerWaiter类没找到更好的方法，留待将来解决吧。
</span><span style="color: #008080;"> 14</span> <span style="color: #008000;"> * 
</span><span style="color: #008080;"> 15</span> <span style="color: #008000;"> * </span><span style="color: #808080;">@author</span><span style="color: #008000;"> mlxy
</span><span style="color: #008080;"> 16</span> <span style="color: #008000;"> * </span><span style="color: #808080;">@version</span><span style="color: #008000;"> 1.1
</span><span style="color: #008080;"> 17</span> <span style="color: #008000;"> * </span><span style="color: #008000;">*/</span>
<span style="color: #008080;"> 18</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> SimChatClient <span style="color: #0000ff;">extends</span><span style="color: #000000;"> JFrame {
</span><span style="color: #008080;"> 19</span>     <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">final</span> <span style="color: #0000ff;">long</span> serialVersionUID = 1L<span style="color: #000000;">;
</span><span style="color: #008080;"> 20</span>     
<span style="color: #008080;"> 21</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> 框架相关变量。</span>
<span style="color: #008080;"> 22</span>     <span style="color: #0000ff;">private</span><span style="color: #000000;"> JPanel panel;
</span><span style="color: #008080;"> 23</span>     <span style="color: #0000ff;">private</span><span style="color: #000000;"> JTextArea area;
</span><span style="color: #008080;"> 24</span>     <span style="color: #0000ff;">private</span><span style="color: #000000;"> JTextField field;
</span><span style="color: #008080;"> 25</span>     <span style="color: #0000ff;">private</span><span style="color: #000000;"> JScrollPane scrollPane;
</span><span style="color: #008080;"> 26</span>     
<span style="color: #008080;"> 27</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> 用户相关变量。</span>
<span style="color: #008080;"> 28</span>     <span style="color: #0000ff;">private</span><span style="color: #000000;"> String userID;
</span><span style="color: #008080;"> 29</span> 
<span style="color: #008080;"> 30</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> 网络相关变量。</span>
<span style="color: #008080;"> 31</span>     <span style="color: #0000ff;">private</span><span style="color: #000000;"> String serverIP;
</span><span style="color: #008080;"> 32</span>     <span style="color: #008000;">//</span><span style="color: #008000;">private int serverPort; *备用*</span>
<span style="color: #008080;"> 33</span>     <span style="color: #0000ff;">private</span> Socket socket = <span style="color: #0000ff;">null</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 34</span>     <span style="color: #0000ff;">private</span> ObjectOutputStream oos = <span style="color: #0000ff;">null</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 35</span>     <span style="color: #0000ff;">private</span> ObjectInputStream ois = <span style="color: #0000ff;">null</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 36</span> 
<span style="color: #008080;"> 37</span>     <span style="color: #008000;">/**</span><span style="color: #008000;"> 默认构造方法，初始化用户ID及框架内容。 </span><span style="color: #008000;">*/</span>
<span style="color: #008080;"> 38</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> SimChatClient() {
</span><span style="color: #008080;"> 39</span>         String userName =<span style="color: #000000;"> (String) JOptionPane.showInputDialog(
</span><span style="color: #008080;"> 40</span>                 <span style="color: #0000ff;">null</span>, "请输入用户ID：", "新用户"<span style="color: #000000;">, JOptionPane.PLAIN_MESSAGE,
</span><span style="color: #008080;"> 41</span>                 <span style="color: #0000ff;">null</span>, <span style="color: #0000ff;">null</span>, <span style="color: #0000ff;">new</span> String("Default"<span style="color: #000000;">));
</span><span style="color: #008080;"> 42</span>         <span style="color: #0000ff;">if</span> (userName == <span style="color: #0000ff;">null</span><span style="color: #000000;">)
</span><span style="color: #008080;"> 43</span>             System.exit(0<span style="color: #000000;">);
</span><span style="color: #008080;"> 44</span>         <span style="color: #0000ff;">else</span>
<span style="color: #008080;"> 45</span>             userID =<span style="color: #000000;"> userName;
</span><span style="color: #008080;"> 46</span>         
<span style="color: #008080;"> 47</span>         String ip =<span style="color: #000000;"> (String) JOptionPane.showInputDialog(
</span><span style="color: #008080;"> 48</span>                 <span style="color: #0000ff;">null</span>, "请输入服务器IP：", "确认客户端IP"<span style="color: #000000;">, JOptionPane.PLAIN_MESSAGE,
</span><span style="color: #008080;"> 49</span>                 <span style="color: #0000ff;">null</span>, <span style="color: #0000ff;">null</span>, <span style="color: #0000ff;">new</span> String("192.168.1.104"<span style="color: #000000;">));
</span><span style="color: #008080;"> 50</span>         <span style="color: #0000ff;">if</span> (ip == <span style="color: #0000ff;">null</span><span style="color: #000000;">)
</span><span style="color: #008080;"> 51</span>             System.exit(0<span style="color: #000000;">);
</span><span style="color: #008080;"> 52</span>         <span style="color: #0000ff;">else</span>
<span style="color: #008080;"> 53</span>             serverIP =<span style="color: #000000;"> ip;
</span><span style="color: #008080;"> 54</span> 
<span style="color: #008080;"> 55</span>         panel = <span style="color: #0000ff;">new</span><span style="color: #000000;"> JPanel();
</span><span style="color: #008080;"> 56</span>         panel.setLayout(<span style="color: #0000ff;">new</span><span style="color: #000000;"> BorderLayout());
</span><span style="color: #008080;"> 57</span> 
<span style="color: #008080;"> 58</span>         area = <span style="color: #0000ff;">new</span><span style="color: #000000;"> JTextArea();
</span><span style="color: #008080;"> 59</span>         area.setLineWrap(<span style="color: #0000ff;">true</span><span style="color: #000000;">);
</span><span style="color: #008080;"> 60</span>         area.setWrapStyleWord(<span style="color: #0000ff;">true</span><span style="color: #000000;">);
</span><span style="color: #008080;"> 61</span>         area.setEditable(<span style="color: #0000ff;">false</span><span style="color: #000000;">);
</span><span style="color: #008080;"> 62</span>         area.setBackground(<span style="color: #0000ff;">new</span> Color(255, 204, 255<span style="color: #000000;">));
</span><span style="color: #008080;"> 63</span>         scrollPane = <span style="color: #0000ff;">new</span><span style="color: #000000;"> JScrollPane(area);
</span><span style="color: #008080;"> 64</span> 
<span style="color: #008080;"> 65</span>         field = <span style="color: #0000ff;">new</span><span style="color: #000000;"> JTextField();
</span><span style="color: #008080;"> 66</span>         field.setBackground(<span style="color: #0000ff;">new</span> Color(66, 204, 255<span style="color: #000000;">));
</span><span style="color: #008080;"> 67</span>         field.addActionListener(<span style="color: #0000ff;">new</span><span style="color: #000000;"> FieldListener());
</span><span style="color: #008080;"> 68</span> 
<span style="color: #008080;"> 69</span> <span style="color: #000000;">        panel.add(scrollPane, BorderLayout.CENTER);
</span><span style="color: #008080;"> 70</span> <span style="color: #000000;">        panel.add(field, BorderLayout.SOUTH);
</span><span style="color: #008080;"> 71</span> 
<span style="color: #008080;"> 72</span>         <span style="color: #0000ff;">this</span><span style="color: #000000;">.add(panel);
</span><span style="color: #008080;"> 73</span>         <span style="color: #0000ff;">this</span>.addWindowListener(<span style="color: #0000ff;">new</span><span style="color: #000000;"> WindowAdapter() {
</span><span style="color: #008080;"> 74</span> 
<span style="color: #008080;"> 75</span> <span style="color: #000000;">            @Override
</span><span style="color: #008080;"> 76</span>             <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> windowClosing(WindowEvent e) {
</span><span style="color: #008080;"> 77</span> <span style="color: #000000;">                disconnect();
</span><span style="color: #008080;"> 78</span>                 System.exit(0<span style="color: #000000;">);
</span><span style="color: #008080;"> 79</span> <span style="color: #000000;">            }
</span><span style="color: #008080;"> 80</span> 
<span style="color: #008080;"> 81</span> <span style="color: #000000;">            @Override
</span><span style="color: #008080;"> 82</span>             <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> windowActivated(WindowEvent e) {
</span><span style="color: #008080;"> 83</span>                 <span style="color: #0000ff;">super</span><span style="color: #000000;">.windowActivated(e);
</span><span style="color: #008080;"> 84</span> <span style="color: #000000;">                field.requestFocusInWindow();
</span><span style="color: #008080;"> 85</span> <span style="color: #000000;">            }
</span><span style="color: #008080;"> 86</span> <span style="color: #000000;">        });
</span><span style="color: #008080;"> 87</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 88</span> 
<span style="color: #008080;"> 89</span>     <span style="color: #008000;">/**</span><span style="color: #008000;"> 主运行方法。 </span><span style="color: #008000;">*/</span>
<span style="color: #008080;"> 90</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> main(String[] args) {
</span><span style="color: #008080;"> 91</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> 设置UI风格。</span>
<span style="color: #008080;"> 92</span>         <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
</span><span style="color: #008080;"> 93</span>             UIManager.setLookAndFeel("com.sun.java.swing.plaf.nimbus.NimbusLookAndFeel"<span style="color: #000000;">);
</span><span style="color: #008080;"> 94</span>         } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (UnsupportedLookAndFeelException e) {
</span><span style="color: #008080;"> 95</span> <span style="color: #000000;">            e.printStackTrace();
</span><span style="color: #008080;"> 96</span>         } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (ClassNotFoundException e) {
</span><span style="color: #008080;"> 97</span> <span style="color: #000000;">            e.printStackTrace();
</span><span style="color: #008080;"> 98</span>         } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (InstantiationException e) {
</span><span style="color: #008080;"> 99</span> <span style="color: #000000;">            e.printStackTrace();
</span><span style="color: #008080;">100</span>         } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (IllegalAccessException e) {
</span><span style="color: #008080;">101</span> <span style="color: #000000;">            e.printStackTrace();
</span><span style="color: #008080;">102</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">103</span>         
<span style="color: #008080;">104</span>         SimChatClient frame = <span style="color: #0000ff;">new</span><span style="color: #000000;"> SimChatClient();
</span><span style="color: #008080;">105</span> <span style="color: #000000;">        frame.launchFrame();
</span><span style="color: #008080;">106</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">107</span> 
<span style="color: #008080;">108</span>     <span style="color: #008000;">/**</span><span style="color: #008000;"> 框架参数初始化。 </span><span style="color: #008000;">*/</span>
<span style="color: #008080;">109</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> launchFrame() {
</span><span style="color: #008080;">110</span>         setTitle("Simple Chat Online: " +<span style="color: #000000;"> userID);
</span><span style="color: #008080;">111</span>         setSize(400, 500<span style="color: #000000;">);
</span><span style="color: #008080;">112</span>         setLocationRelativeTo(<span style="color: #0000ff;">null</span><span style="color: #000000;">);
</span><span style="color: #008080;">113</span>         setVisible(<span style="color: #0000ff;">true</span><span style="color: #000000;">);
</span><span style="color: #008080;">114</span> 
<span style="color: #008080;">115</span> <span style="color: #000000;">        connect();
</span><span style="color: #008080;">116</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">117</span> 
<span style="color: #008080;">118</span>     <span style="color: #008000;">/**</span><span style="color: #008000;"> 连接到服务器端。 </span><span style="color: #008000;">*/</span>
<span style="color: #008080;">119</span>     <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> connect() {
</span><span style="color: #008080;">120</span>         <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
</span><span style="color: #008080;">121</span>             socket = <span style="color: #0000ff;">new</span> Socket(serverIP, 2333<span style="color: #000000;">);
</span><span style="color: #008080;">122</span>             oos = <span style="color: #0000ff;">new</span><span style="color: #000000;"> ObjectOutputStream(socket.getOutputStream());
</span><span style="color: #008080;">123</span>             <span style="color: #0000ff;">new</span> Thread(<span style="color: #0000ff;">new</span><span style="color: #000000;"> ServerWaiter()).start();
</span><span style="color: #008080;">124</span>         } <span style="color: #0000ff;">catch</span><span style="color: #000000;">(ConnectException e) {
</span><span style="color: #008080;">125</span>             JOptionPane.showMessageDialog(<span style="color: #0000ff;">null</span><span style="color: #000000;">, 
</span><span style="color: #008080;">126</span>                     "服务器未启动，请联系系统管理员。", "连接失败"<span style="color: #000000;">, JOptionPane.WARNING_MESSAGE);
</span><span style="color: #008080;">127</span>             System.exit(0<span style="color: #000000;">);
</span><span style="color: #008080;">128</span>         } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (IOException e) {
</span><span style="color: #008080;">129</span> <span style="color: #000000;">            e.printStackTrace();
</span><span style="color: #008080;">130</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">131</span>         area.setText("Connection established.\n"<span style="color: #000000;">);
</span><span style="color: #008080;">132</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">133</span> 
<span style="color: #008080;">134</span>     <span style="color: #008000;">/**</span><span style="color: #008000;"> 释放资源，与服务器断开连接。 </span><span style="color: #008000;">*/</span>
<span style="color: #008080;">135</span>     <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> disconnect() {
</span><span style="color: #008080;">136</span>         <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
</span><span style="color: #008080;">137</span>             <span style="color: #0000ff;">if</span> (ois != <span style="color: #0000ff;">null</span><span style="color: #000000;">)
</span><span style="color: #008080;">138</span> <span style="color: #000000;">                ois.close();
</span><span style="color: #008080;">139</span>             <span style="color: #0000ff;">if</span> (oos != <span style="color: #0000ff;">null</span><span style="color: #000000;">)
</span><span style="color: #008080;">140</span> <span style="color: #000000;">                oos.close();
</span><span style="color: #008080;">141</span>         } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (IOException e) {
</span><span style="color: #008080;">142</span> <span style="color: #000000;">            e.printStackTrace();
</span><span style="color: #008080;">143</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">144</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">145</span>     
<span style="color: #008080;">146</span>     <span style="color: #008000;">/**</span> 
<span style="color: #008080;">147</span> <span style="color: #008000;">     * 按照格式更新文本框内容。
</span><span style="color: #008080;">148</span> <span style="color: #008000;">     * 
</span><span style="color: #008080;">149</span> <span style="color: #008000;">     * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> userName 用户名
</span><span style="color: #008080;">150</span> <span style="color: #008000;">     * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> content 消息内容
</span><span style="color: #008080;">151</span>      <span style="color: #008000;">*/</span>
<span style="color: #008080;">152</span>     <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> updateTextArea(String userName, String content) {
</span><span style="color: #008080;">153</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> 之后加上发送时间。</span>
<span style="color: #008080;">154</span>         area.setText(area.getText() + "[ " + userName + " ] : " + content + "\n"<span style="color: #000000;">);
</span><span style="color: #008080;">155</span>         JScrollBar tempBar =<span style="color: #000000;"> scrollPane.getVerticalScrollBar();
</span><span style="color: #008080;">156</span> <span style="color: #000000;">        tempBar.setValue(tempBar.getMaximum());
</span><span style="color: #008080;">157</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">158</span> 
<span style="color: #008080;">159</span>     <span style="color: #008000;">/**</span><span style="color: #008000;"> 内部类，输入框的监听器。 </span><span style="color: #008000;">*/</span>
<span style="color: #008080;">160</span>     <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">class</span> FieldListener <span style="color: #0000ff;">implements</span><span style="color: #000000;"> ActionListener {
</span><span style="color: #008080;">161</span> 
<span style="color: #008080;">162</span> <span style="color: #000000;">        @Override
</span><span style="color: #008080;">163</span>         <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> actionPerformed(ActionEvent e) {
</span><span style="color: #008080;">164</span>             <span style="color: #008000;">//</span><span style="color: #008000;"> 按下回车后向服务器发包，然后清空输入框。</span>
<span style="color: #008080;">165</span> <span style="color: #000000;">            sendPackage();
</span><span style="color: #008080;">166</span>             field.setText(""<span style="color: #000000;">);
</span><span style="color: #008080;">167</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">168</span> 
<span style="color: #008080;">169</span>         <span style="color: #008000;">/**</span><span style="color: #008000;"> 私有方法，读取用户ID和输入内容，向服务器发送包。 </span><span style="color: #008000;">*/</span>
<span style="color: #008080;">170</span>         <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> sendPackage() {
</span><span style="color: #008080;">171</span>             String[] packToSend =<span style="color: #000000;"> { userID, field.getText() };
</span><span style="color: #008080;">172</span> 
<span style="color: #008080;">173</span>             <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
</span><span style="color: #008080;">174</span> <span style="color: #000000;">                oos.writeObject(packToSend);
</span><span style="color: #008080;">175</span> <span style="color: #000000;">                oos.flush();
</span><span style="color: #008080;">176</span>             } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (IOException ex) {
</span><span style="color: #008080;">177</span> <span style="color: #000000;">                ex.printStackTrace();
</span><span style="color: #008080;">178</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">179</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">180</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">181</span> 
<span style="color: #008080;">182</span>     <span style="color: #008000;">/**</span><span style="color: #008000;"> 内部类，等待服务器发包的线程类。
</span><span style="color: #008080;">183</span> <span style="color: #008000;">     * 
</span><span style="color: #008080;">184</span> <span style="color: #008000;">     * </span><span style="color: #808080;">@author</span><span style="color: #008000;"> mlxy
</span><span style="color: #008080;">185</span> <span style="color: #008000;">     * </span><span style="color: #808080;">@version</span><span style="color: #008000;"> 0.8
</span><span style="color: #008080;">186</span> <span style="color: #008000;">     * </span><span style="color: #008000;">*/</span>
<span style="color: #008080;">187</span>     <span style="color: #0000ff;">class</span> ServerWaiter <span style="color: #0000ff;">implements</span><span style="color: #000000;"> Runnable {
</span><span style="color: #008080;">188</span>         <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> run() {
</span><span style="color: #008080;">189</span>             <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
</span><span style="color: #008080;">190</span>                 ois = <span style="color: #0000ff;">new</span><span style="color: #000000;"> ObjectInputStream(socket.getInputStream());
</span><span style="color: #008080;">191</span> 
<span style="color: #008080;">192</span>                 <span style="color: #008000;">//</span><span style="color: #008000;"> 死循环，阻塞式地从服务器读包，之后更新文本框。</span>
<span style="color: #008080;">193</span>                 <span style="color: #0000ff;">while</span> (<span style="color: #0000ff;">true</span><span style="color: #000000;">) {
</span><span style="color: #008080;">194</span>                     <span style="color: #008000;">//</span><span style="color: #008000;"> 程序被readObject阻塞住的时候如果关闭框架会报错。之后解决。</span>
<span style="color: #008080;">195</span>                     String[] packReceived =<span style="color: #000000;"> (String[]) ois.readObject();
</span><span style="color: #008080;">196</span>                     updateTextArea(packReceived[0], packReceived[1<span style="color: #000000;">]);
</span><span style="color: #008080;">197</span> <span style="color: #000000;">                }
</span><span style="color: #008080;">198</span>             } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (SocketException e) {
</span><span style="color: #008080;">199</span>                 <span style="color: #008000;">//</span><span style="color: #008000;"> 目前是简单粗暴地抓了异常就跳出程序。</span>
<span style="color: #008080;">200</span>                 System.out.println("Socket closed, client out."<span style="color: #000000;">);
</span><span style="color: #008080;">201</span>                 System.exit(-1<span style="color: #000000;">);
</span><span style="color: #008080;">202</span>             } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (IOException e) {
</span><span style="color: #008080;">203</span> <span style="color: #000000;">                e.printStackTrace();
</span><span style="color: #008080;">204</span>             } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (ClassNotFoundException e) {
</span><span style="color: #008080;">205</span> <span style="color: #000000;">                e.printStackTrace();
</span><span style="color: #008080;">206</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">207</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">208</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">209</span> }</pre>
</div>
<span class="cnblogs_code_collapse">Client </span></div>
<p>&nbsp;</p>

<div align=right><a href="https://github.com/mlxy/SRBCnblogs"><font size=1>——本文由博客园搬家工具SRBCnblogs转换而成</font></a></div>