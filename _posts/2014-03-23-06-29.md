---
layout: post
title: 天气应用工事中
date: 2014-03-23 06:29:00
categories: cnblogs
---

<p>再不说点什么可能都忘了我写了些什么了。</p>
<p>折腾了快一个周，只写出了两个处理xml文件的模块。</p>
<p>用的API是新浪的，格式大概是这个样子：</p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff;">private</span> String city = CharacterProcesser.encodeByGB2312("南昌"<span style="color: #000000;">);
</span><span style="color: #0000ff;">private</span> String password = "DJOYnieT8234jlsK"<span style="color: #000000;">;
</span><span style="color: #0000ff;">private</span> <span style="color: #0000ff;">int</span> day = 0<span style="color: #000000;">;
</span><span style="color: #0000ff;">private</span> String link = "http://php.weather.sina.com.cn/xml.php?city=" +<span style="color: #000000;"> city
            </span>+ "&amp;password=" + password + "&amp;day=" + day;</pre>
</div>
<p>上面那个encode方法就是这两天卡住我的问题之一，不过其实是今天才发现的。</p>
<p>先发代码吧，只有两个模块，完成度还都不高，其实不应该是1.0的。</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('d8d50a81-7527-4672-b966-1e7bf47dee67')"><img id="code_img_closed_d8d50a81-7527-4672-b966-1e7bf47dee67" class="code_img_closed" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" /><img id="code_img_opened_d8d50a81-7527-4672-b966-1e7bf47dee67" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('d8d50a81-7527-4672-b966-1e7bf47dee67',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt="" />
<div id="cnblogs_code_open_d8d50a81-7527-4672-b966-1e7bf47dee67" class="cnblogs_code_hide">
<pre><span style="color: #008080;">  1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> com.mlxy.xml;
</span><span style="color: #008080;">  2</span> 
<span style="color: #008080;">  3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.io.BufferedReader;
</span><span style="color: #008080;">  4</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.io.File;
</span><span style="color: #008080;">  5</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.io.FileOutputStream;
</span><span style="color: #008080;">  6</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.io.InputStream;
</span><span style="color: #008080;">  7</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.io.InputStreamReader;
</span><span style="color: #008080;">  8</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.io.OutputStreamWriter;
</span><span style="color: #008080;">  9</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.net.MalformedURLException;
</span><span style="color: #008080;"> 10</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.net.URL;
</span><span style="color: #008080;"> 11</span> 
<span style="color: #008080;"> 12</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.dom4j.Document;
</span><span style="color: #008080;"> 13</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.dom4j.DocumentException;
</span><span style="color: #008080;"> 14</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.dom4j.Node;
</span><span style="color: #008080;"> 15</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.dom4j.io.SAXReader;
</span><span style="color: #008080;"> 16</span> 
<span style="color: #008080;"> 17</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> android.content.Context;
</span><span style="color: #008080;"> 18</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> android.os.Environment;
</span><span style="color: #008080;"> 19</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> android.util.Log;
</span><span style="color: #008080;"> 20</span> 
<span style="color: #008080;"> 21</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.mlxy.util.CharacterProcesser;
</span><span style="color: #008080;"> 22</span> 
<span style="color: #008080;"> 23</span> <span style="color: #008000;">/**</span> 
<span style="color: #008080;"> 24</span> <span style="color: #008000;"> * XML文件下载器。
</span><span style="color: #008080;"> 25</span> <span style="color: #008000;"> * 
</span><span style="color: #008080;"> 26</span> <span style="color: #008000;"> * </span><span style="color: #808080;">@author</span><span style="color: #008000;"> mlxy
</span><span style="color: #008080;"> 27</span> <span style="color: #008000;"> * </span><span style="color: #808080;">@version</span><span style="color: #008000;"> 1.0
</span><span style="color: #008080;"> 28</span> <span style="color: #008000;"> * </span><span style="color: #008000;">*/</span>
<span style="color: #008080;"> 29</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> XmlDownloader {
</span><span style="color: #008080;"> 30</span>     <span style="color: #0000ff;">private</span><span style="color: #000000;"> Context parent;
</span><span style="color: #008080;"> 31</span>     
<span style="color: #008080;"> 32</span>     <span style="color: #0000ff;">private</span> String city = CharacterProcesser.encodeByGB2312("南昌"<span style="color: #000000;">);
</span><span style="color: #008080;"> 33</span>     <span style="color: #0000ff;">private</span> String password = "DJOYnieT8234jlsK"<span style="color: #000000;">;
</span><span style="color: #008080;"> 34</span>     <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">int</span> day = 0<span style="color: #000000;">;
</span><span style="color: #008080;"> 35</span>     <span style="color: #0000ff;">private</span> String link = "http://php.weather.sina.com.cn/xml.php?city=" +<span style="color: #000000;"> city
</span><span style="color: #008080;"> 36</span>             + "&amp;password=" + password + "&amp;day=" +<span style="color: #000000;"> day;
</span><span style="color: #008080;"> 37</span>     
<span style="color: #008080;"> 38</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> XmlDownloader(Context parent) {
</span><span style="color: #008080;"> 39</span>         <span style="color: #0000ff;">this</span>.parent =<span style="color: #000000;"> parent;
</span><span style="color: #008080;"> 40</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 41</span>     
<span style="color: #008080;"> 42</span>     <span style="color: #008000;">/**</span><span style="color: #008000;"> 外部接口，根据设置好的类属性下载xml文件。
</span><span style="color: #008080;"> 43</span> <span style="color: #008000;">     * 
</span><span style="color: #008080;"> 44</span> <span style="color: #008000;">     * </span><span style="color: #808080;">@return</span><span style="color: #008000;"> 下载成功则返回true，失败则返回false。</span><span style="color: #008000;">*/</span>
<span style="color: #008080;"> 45</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">boolean</span><span style="color: #000000;"> download() {
</span><span style="color: #008080;"> 46</span>         <span style="color: #0000ff;">return</span> downloadAndVerifyXml(<span style="color: #0000ff;">this</span><span style="color: #000000;">.link);
</span><span style="color: #008080;"> 47</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 48</span>     
<span style="color: #008080;"> 49</span>     <span style="color: #008000;">/**</span><span style="color: #008000;"> 根据给定的链接下载对应的xml文件。
</span><span style="color: #008080;"> 50</span> <span style="color: #008000;">     * 
</span><span style="color: #008080;"> 51</span> <span style="color: #008000;">     * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> link API的链接，需要标明网络协议。
</span><span style="color: #008080;"> 52</span> <span style="color: #008000;">     * </span><span style="color: #808080;">@return</span><span style="color: #008000;"> 下载并验证格式正确则返回true，否则返回false。</span><span style="color: #008000;">*/</span>
<span style="color: #008080;"> 53</span>     <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">boolean</span><span style="color: #000000;"> downloadAndVerifyXml(String link) {
</span><span style="color: #008080;"> 54</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> 用链接字符串new出URL对象</span>
<span style="color: #008080;"> 55</span>         URL url = <span style="color: #0000ff;">null</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 56</span>         <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
</span><span style="color: #008080;"> 57</span>             url = <span style="color: #0000ff;">new</span><span style="color: #000000;"> URL(link);
</span><span style="color: #008080;"> 58</span>         } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (MalformedURLException e) {
</span><span style="color: #008080;"> 59</span> <span style="color: #000000;">            e.printStackTrace();
</span><span style="color: #008080;"> 60</span> <span style="color: #000000;">        }
</span><span style="color: #008080;"> 61</span> 
<span style="color: #008080;"> 62</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> 获取外部存储路径并创建文件对象。</span>
<span style="color: #008080;"> 63</span>         File externalDirectory =<span style="color: #000000;"> Environment.getExternalStorageDirectory();
</span><span style="color: #008080;"> 64</span>         String fileName = "xml_resource.xml"<span style="color: #000000;">;
</span><span style="color: #008080;"> 65</span>         File file = <span style="color: #0000ff;">new</span><span style="color: #000000;"> File(externalDirectory, fileName);
</span><span style="color: #008080;"> 66</span>         
<span style="color: #008080;"> 67</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> 写文件。
</span><span style="color: #008080;"> 68</span>         
<span style="color: #008080;"> 69</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> 初始化io流。</span>
<span style="color: #008080;"> 70</span>         InputStream in = <span style="color: #0000ff;">null</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 71</span>         BufferedReader reader = <span style="color: #0000ff;">null</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 72</span>         FileOutputStream out = <span style="color: #0000ff;">null</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 73</span>         OutputStreamWriter writer = <span style="color: #0000ff;">null</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 74</span>         
<span style="color: #008080;"> 75</span>         <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
</span><span style="color: #008080;"> 76</span>             
<span style="color: #008080;"> 77</span>             <span style="color: #008000;">//</span><span style="color: #008000;"> 建立连接并给io流赋值。</span>
<span style="color: #008080;"> 78</span>             in =<span style="color: #000000;"> (InputStream) url.getContent();
</span><span style="color: #008080;"> 79</span>             reader = <span style="color: #0000ff;">new</span> BufferedReader(<span style="color: #0000ff;">new</span> InputStreamReader(in, "iso-8859-1"<span style="color: #000000;">));
</span><span style="color: #008080;"> 80</span>             out = <span style="color: #0000ff;">this</span><span style="color: #000000;">.parent.openFileOutput(file.getName(), Context.MODE_PRIVATE);
</span><span style="color: #008080;"> 81</span>             writer = <span style="color: #0000ff;">new</span> OutputStreamWriter(out, "iso-8859-1"<span style="color: #000000;">);
</span><span style="color: #008080;"> 82</span>             
<span style="color: #008080;"> 83</span>             <span style="color: #008000;">//</span><span style="color: #008000;"> 读一行写一行</span>
<span style="color: #008080;"> 84</span>             String line = <span style="color: #0000ff;">null</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 85</span>             <span style="color: #0000ff;">while</span> ((line = reader.readLine()) != <span style="color: #0000ff;">null</span><span style="color: #000000;">) {
</span><span style="color: #008080;"> 86</span> Log.v("mlxy"<span style="color: #000000;">, line);
</span><span style="color: #008080;"> 87</span> <span style="color: #000000;">                writer.write(line);
</span><span style="color: #008080;"> 88</span> <span style="color: #000000;">            }
</span><span style="color: #008080;"> 89</span>             
<span style="color: #008080;"> 90</span>         } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (Exception e) {
</span><span style="color: #008080;"> 91</span> <span style="color: #000000;">            e.printStackTrace();
</span><span style="color: #008080;"> 92</span>         } <span style="color: #0000ff;">finally</span><span style="color: #000000;"> {
</span><span style="color: #008080;"> 93</span>             <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
</span><span style="color: #008080;"> 94</span>                 <span style="color: #008000;">//</span><span style="color: #008000;"> 释放资源</span>
<span style="color: #008080;"> 95</span> <span style="color: #000000;">                writer.close();
</span><span style="color: #008080;"> 96</span> <span style="color: #000000;">                out.close();
</span><span style="color: #008080;"> 97</span> <span style="color: #000000;">                reader.close();
</span><span style="color: #008080;"> 98</span> <span style="color: #000000;">                in.close();
</span><span style="color: #008080;"> 99</span>             } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (Exception e2) {
</span><span style="color: #008080;">100</span> <span style="color: #000000;">                e2.printStackTrace();
</span><span style="color: #008080;">101</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">102</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">103</span>         
<span style="color: #008080;">104</span> <span style="color: #008000;">//</span>        <span style="color: #008000;">//</span><span style="color: #008000;"> 验证信息是否成功获取。
</span><span style="color: #008080;">105</span> <span style="color: #008000;">//</span><span style="color: #008000;">        if (isAvailable(file)) {
</span><span style="color: #008080;">106</span> <span style="color: #008000;">//</span><span style="color: #008000;">            return true;
</span><span style="color: #008080;">107</span> <span style="color: #008000;">//</span><span style="color: #008000;">        } else {
</span><span style="color: #008080;">108</span> <span style="color: #008000;">//</span><span style="color: #008000;">            return false;
</span><span style="color: #008080;">109</span> <span style="color: #008000;">//</span><span style="color: #008000;">        }</span>
<span style="color: #008080;">110</span> Log.v("mlxy", "ok"<span style="color: #000000;">);
</span><span style="color: #008080;">111</span>         <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">true</span><span style="color: #000000;">;
</span><span style="color: #008080;">112</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">113</span>     
<span style="color: #008080;">114</span>     <span style="color: #008000;">/**</span><span style="color: #008000;"> 验证xml文件是否符合要求。
</span><span style="color: #008080;">115</span> <span style="color: #008000;">     * 
</span><span style="color: #008080;">116</span> <span style="color: #008000;">     * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> xmlFile 用以验证合法性的xml文件。
</span><span style="color: #008080;">117</span> <span style="color: #008000;">     * </span><span style="color: #808080;">@return</span><span style="color: #008000;"> 符合需要格式则返回true，否则返回false。</span><span style="color: #008000;">*/</span>
<span style="color: #008080;">118</span>     <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">boolean</span><span style="color: #000000;"> isAvailable(File xmlFile) {
</span><span style="color: #008080;">119</span>         <span style="color: #0000ff;">if</span> (!<span style="color: #000000;">xmlFile.exists()) {
</span><span style="color: #008080;">120</span>             <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">false</span><span style="color: #000000;">;
</span><span style="color: #008080;">121</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">122</span>         
<span style="color: #008080;">123</span>         SAXReader reader = <span style="color: #0000ff;">new</span><span style="color: #000000;"> SAXReader();
</span><span style="color: #008080;">124</span>         Document doc = <span style="color: #0000ff;">null</span><span style="color: #000000;">;
</span><span style="color: #008080;">125</span>         <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
</span><span style="color: #008080;">126</span>             doc =<span style="color: #000000;"> reader.read(xmlFile);
</span><span style="color: #008080;">127</span>         } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (DocumentException e) {
</span><span style="color: #008080;">128</span> <span style="color: #000000;">            e.printStackTrace();
</span><span style="color: #008080;">129</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">130</span>         
<span style="color: #008080;">131</span>         <span style="color: #0000ff;">if</span> (doc == <span style="color: #0000ff;">null</span><span style="color: #000000;">) {
</span><span style="color: #008080;">132</span>             <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">false</span><span style="color: #000000;">;
</span><span style="color: #008080;">133</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">134</span>         
<span style="color: #008080;">135</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> 检查城市节点是否存在，不存在则返回false。</span>
<span style="color: #008080;">136</span>         Node node = doc.selectSingleNode("//Profiles/Weather/city"<span style="color: #000000;">);
</span><span style="color: #008080;">137</span>         
<span style="color: #008080;">138</span>         <span style="color: #0000ff;">if</span> (node == <span style="color: #0000ff;">null</span><span style="color: #000000;">) {
</span><span style="color: #008080;">139</span>             <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">false</span><span style="color: #000000;">;
</span><span style="color: #008080;">140</span>         } <span style="color: #0000ff;">else</span><span style="color: #000000;"> {
</span><span style="color: #008080;">141</span>             <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">true</span><span style="color: #000000;">;
</span><span style="color: #008080;">142</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">143</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">144</span>     
<span style="color: #008080;">145</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> XmlDownloader setCity(String city) {
</span><span style="color: #008080;">146</span>         <span style="color: #0000ff;">this</span>.city =<span style="color: #000000;"> city;
</span><span style="color: #008080;">147</span>         <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span><span style="color: #000000;">;
</span><span style="color: #008080;">148</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">149</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> String getCity() {
</span><span style="color: #008080;">150</span>         <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span><span style="color: #000000;">.city;
</span><span style="color: #008080;">151</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">152</span>     
<span style="color: #008080;">153</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> XmlDownloader setPassword(String password) {
</span><span style="color: #008080;">154</span>         <span style="color: #0000ff;">this</span>.password =<span style="color: #000000;"> password;
</span><span style="color: #008080;">155</span>         <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span><span style="color: #000000;">;
</span><span style="color: #008080;">156</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">157</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> String getPassword() {
</span><span style="color: #008080;">158</span>         <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span><span style="color: #000000;">.password;
</span><span style="color: #008080;">159</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">160</span>     
<span style="color: #008080;">161</span>     <span style="color: #0000ff;">public</span> XmlDownloader setDay(<span style="color: #0000ff;">int</span><span style="color: #000000;"> day) {
</span><span style="color: #008080;">162</span>         <span style="color: #0000ff;">this</span>.day =<span style="color: #000000;"> day;
</span><span style="color: #008080;">163</span>         <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span><span style="color: #000000;">;
</span><span style="color: #008080;">164</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">165</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">int</span><span style="color: #000000;"> getDay() {
</span><span style="color: #008080;">166</span>         <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span><span style="color: #000000;">.day;
</span><span style="color: #008080;">167</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">168</span>     
<span style="color: #008080;">169</span>     <span style="color: #008000;">/**</span><span style="color: #008000;"> 获取API链接。</span><span style="color: #008000;">*/</span>
<span style="color: #008080;">170</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> String getLink() {
</span><span style="color: #008080;">171</span>         <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span><span style="color: #000000;">.link;
</span><span style="color: #008080;">172</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">173</span> }</pre>
</div>
<span class="cnblogs_code_collapse">xml下载模块</span></div>
<div class="cnblogs_code" onclick="cnblogs_code_show('bc481b2b-53e3-47e0-be5e-2dd5bb92adad')"><img id="code_img_closed_bc481b2b-53e3-47e0-be5e-2dd5bb92adad" class="code_img_closed" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" /><img id="code_img_opened_bc481b2b-53e3-47e0-be5e-2dd5bb92adad" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('bc481b2b-53e3-47e0-be5e-2dd5bb92adad',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt="" />
<div id="cnblogs_code_open_bc481b2b-53e3-47e0-be5e-2dd5bb92adad" class="cnblogs_code_hide">
<pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> com.mlxy.xml;
</span><span style="color: #008080;"> 2</span> 
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.dom4j.Document;
</span><span style="color: #008080;"> 4</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.dom4j.Node;
</span><span style="color: #008080;"> 5</span> 
<span style="color: #008080;"> 6</span> <span style="color: #008000;">/**</span> 
<span style="color: #008080;"> 7</span> <span style="color: #008000;"> * xml的解析器，包含了获取所需节点内容的方法。
</span><span style="color: #008080;"> 8</span> <span style="color: #008000;"> * 
</span><span style="color: #008080;"> 9</span> <span style="color: #008000;"> * </span><span style="color: #808080;">@author</span><span style="color: #008000;"> mlxy
</span><span style="color: #008080;">10</span> <span style="color: #008000;"> * </span><span style="color: #808080;">@version</span><span style="color: #008000;"> 1.0
</span><span style="color: #008080;">11</span> <span style="color: #008000;"> * </span><span style="color: #008000;">*/</span>
<span style="color: #008080;">12</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> XmlParser {
</span><span style="color: #008080;">13</span>     
<span style="color: #008080;">14</span>     <span style="color: #008000;">/**</span><span style="color: #008000;"> 根据给定的文档和节点返回节点内容。
</span><span style="color: #008080;">15</span> <span style="color: #008000;">     * 
</span><span style="color: #008080;">16</span> <span style="color: #008000;">     * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> doc nodeName 需要解析的Document对象，以及要获取其内容的节点名称。
</span><span style="color: #008080;">17</span> <span style="color: #008000;">     * </span><span style="color: #808080;">@return</span><span style="color: #008000;"> 获取失败则返回空值，否则返回节点内容。</span><span style="color: #008000;">*/</span>
<span style="color: #008080;">18</span>     <span style="color: #0000ff;">private</span><span style="color: #000000;"> String getNodeText(Document doc, String nodeName) {
</span><span style="color: #008080;">19</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> 如果传入的文档是空值就返回空值。</span>
<span style="color: #008080;">20</span>         <span style="color: #0000ff;">if</span> (doc == <span style="color: #0000ff;">null</span><span style="color: #000000;">) {
</span><span style="color: #008080;">21</span>             <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">null</span><span style="color: #000000;">;
</span><span style="color: #008080;">22</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">23</span>         
<span style="color: #008080;">24</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> 获取相应节点。</span>
<span style="color: #008080;">25</span>         Node node = doc.selectSingleNode("//Profiles/Weather/" +<span style="color: #000000;"> nodeName);
</span><span style="color: #008080;">26</span>         
<span style="color: #008080;">27</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> 如果节点是空值就返回空值。</span>
<span style="color: #008080;">28</span>         <span style="color: #0000ff;">if</span> (node == <span style="color: #0000ff;">null</span><span style="color: #000000;">) {
</span><span style="color: #008080;">29</span>             <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">null</span><span style="color: #000000;">;
</span><span style="color: #008080;">30</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">31</span>         
<span style="color: #008080;">32</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> 获取节点内容并返回字符串。</span>
<span style="color: #008080;">33</span>         String nodeContent =<span style="color: #000000;"> node.getText();
</span><span style="color: #008080;">34</span>         
<span style="color: #008080;">35</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> nodeContent;
</span><span style="color: #008080;">36</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">37</span>     
<span style="color: #008080;">38</span>     <span style="color: #008000;">/**</span><span style="color: #008000;"> 根据输入的Document对象解析xml并返回温度。
</span><span style="color: #008080;">39</span> <span style="color: #008000;">     * 
</span><span style="color: #008080;">40</span> <span style="color: #008000;">     * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> doc 需要解析的Document对象。
</span><span style="color: #008080;">41</span> <span style="color: #008000;">     * </span><span style="color: #808080;">@return</span><span style="color: #008000;"> 获取失败返回null，成功则将白天和夜晚的温度格式化为一个字符串并返回</span><span style="color: #008000;">*/</span>
<span style="color: #008080;">42</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> String getTemperature(Document doc) {
</span><span style="color: #008080;">43</span>         String temperatureDaytimeString = <span style="color: #0000ff;">this</span>.getNodeText(doc, "temperature1"<span style="color: #000000;">);
</span><span style="color: #008080;">44</span>         String temperatureNighttimeString = <span style="color: #0000ff;">this</span>.getNodeText(doc, "temperature2"<span style="color: #000000;">);
</span><span style="color: #008080;">45</span>         
<span style="color: #008080;">46</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> 温度获取失败则返回空值。
</span><span style="color: #008080;">47</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> 可能因为文档不存在，也可能因为文档错误导致无法获得相应节点，也可能是节点内容是空值。</span>
<span style="color: #008080;">48</span>         <span style="color: #0000ff;">if</span> (temperatureDaytimeString == <span style="color: #0000ff;">null</span> || temperatureNighttimeString == <span style="color: #0000ff;">null</span><span style="color: #000000;">) {
</span><span style="color: #008080;">49</span>             <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">null</span><span style="color: #000000;">;
</span><span style="color: #008080;">50</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">51</span>         
<span style="color: #008080;">52</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> 获取成功则格式化并返回。</span>
<span style="color: #008080;">53</span>         <span style="color: #0000ff;">return</span> temperatureNighttimeString + "℃ - " + temperatureDaytimeString + "℃"<span style="color: #000000;">;
</span><span style="color: #008080;">54</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">55</span>     
<span style="color: #008080;">56</span>     <span style="color: #008000;">/**</span><span style="color: #008000;"> 根据输入的Document对象解析xml并返回天气状况。
</span><span style="color: #008080;">57</span> <span style="color: #008000;">     * 
</span><span style="color: #008080;">58</span> <span style="color: #008000;">     * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> doc 需要解析的Document对象。
</span><span style="color: #008080;">59</span> <span style="color: #008000;">     * </span><span style="color: #808080;">@return</span><span style="color: #008000;"> 获取失败返回null，成功则将白天和夜晚的天气状况格式化为一个字符串并返回。</span><span style="color: #008000;">*/</span>
<span style="color: #008080;">60</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> String getWeather(Document doc) {
</span><span style="color: #008080;">61</span>         String weatherDaytimeString = <span style="color: #0000ff;">this</span>.getNodeText(doc, "status1"<span style="color: #000000;">);
</span><span style="color: #008080;">62</span>         String weatherNighttimeString = <span style="color: #0000ff;">this</span>.getNodeText(doc, "status2"<span style="color: #000000;">);
</span><span style="color: #008080;">63</span>         
<span style="color: #008080;">64</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> 天气状况获取失败则返回空值。
</span><span style="color: #008080;">65</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> 可能因为文档不存在，也可能因为文档错误导致无法获得相应节点，也可能是节点内容是空值。</span>
<span style="color: #008080;">66</span>         <span style="color: #0000ff;">if</span> (weatherDaytimeString == <span style="color: #0000ff;">null</span> || weatherNighttimeString == <span style="color: #0000ff;">null</span><span style="color: #000000;">) {
</span><span style="color: #008080;">67</span>             <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">null</span><span style="color: #000000;">;
</span><span style="color: #008080;">68</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">69</span>         
<span style="color: #008080;">70</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> 获取成功则格式化并返回。</span>
<span style="color: #008080;">71</span>         <span style="color: #0000ff;">return</span> "白天：" + weatherNighttimeString + "  夜间：" +<span style="color: #000000;"> weatherDaytimeString;
</span><span style="color: #008080;">72</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">73</span> }</pre>
</div>
<span class="cnblogs_code_collapse">xml解析模块</span></div>
<p>因为写这篇博文的时候我还在敲代码，所以上面的代码里可能有做到一半的东西，总之是不太能用。</p>
<p>&nbsp;</p>
<p>具体问题还是单独发博吧。</p>

<div align=right><a href="https://github.com/mlxy/SRBCnblogs"><font size=1>——本文由博客园搬家工具SRBCnblogs转换而成</font></a></div>